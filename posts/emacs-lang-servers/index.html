<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="doom-emacs as an ssh IDE with TRAMP using eglot and language servers.
 Background For most of my emacs configuration1, there normally isn&amp;rsquo;t very much to write about which isn&amp;rsquo;t immediately evident from my configuration site. However, since my shift to a MacBook, I have needed to fine tune my existing lsp-mode default setup for TRAMP and this post will cover a little bit of that. Though most of the post is about doom-emacs, it is also applicable to vanilla emacs after porting the snippets over to use-package instead."><meta name=keywords content=",workflow,projects,tools,emacs"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/emacs-lang-servers/><title>Doom Emacs and Language Servers :: Rohit Goswami ‚Äî Reflections</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.b6dbce0fdf6c61563a0c2226e857d5dadd8e5afa2c4f73ec9ea55abd831f9a72.css><meta itemprop=name content="Doom Emacs and Language Servers"><meta itemprop=description content="doom-emacs as an ssh IDE with TRAMP using eglot and language servers.
 Background For most of my emacs configuration1, there normally isn&rsquo;t very much to write about which isn&rsquo;t immediately evident from my configuration site. However, since my shift to a MacBook, I have needed to fine tune my existing lsp-mode default setup for TRAMP and this post will cover a little bit of that. Though most of the post is about doom-emacs, it is also applicable to vanilla emacs after porting the snippets over to use-package instead."><meta itemprop=datePublished content="2021-07-20T02:28:00+00:00"><meta itemprop=dateModified content="2021-07-20T02:28:00+00:00"><meta itemprop=wordCount content="1366"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="workflow,projects,tools,emacs,"><meta property="og:title" content="Doom Emacs and Language Servers"><meta property="og:description" content="doom-emacs as an ssh IDE with TRAMP using eglot and language servers.
 Background For most of my emacs configuration1, there normally isn&rsquo;t very much to write about which isn&rsquo;t immediately evident from my configuration site. However, since my shift to a MacBook, I have needed to fine tune my existing lsp-mode default setup for TRAMP and this post will cover a little bit of that. Though most of the post is about doom-emacs, it is also applicable to vanilla emacs after porting the snippets over to use-package instead."><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/emacs-lang-servers/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-20T02:28:00+00:00"><meta property="article:modified_time" content="2021-07-20T02:28:00+00:00"><meta property="og:site_name" content="Rohit Goswami"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="Doom Emacs and Language Servers"><meta name=twitter:description content="doom-emacs as an ssh IDE with TRAMP using eglot and language servers.
 Background For most of my emacs configuration1, there normally isn&rsquo;t very much to write about which isn&rsquo;t immediately evident from my configuration site. However, since my shift to a MacBook, I have needed to fine tune my existing lsp-mode default setup for TRAMP and this post will cover a little bit of that. Though most of the post is about doom-emacs, it is also applicable to vanilla emacs after porting the snippets over to use-package instead."><meta property="article:section" content="programming"><meta property="article:published_time" content="2021-07-20 02:28:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://rgoswami.me/about>About</a></li><li><a href=https://rgoswami.me/posts>Blog</a></li></ul><ul class=menu__inner><li><a href=https://rgoswami.me/categories>Categories</a></li><li><a href=https://rgoswami.me/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=https://rgoswami.me/js/mathjax-config.js></script>
<script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li><a href=#desiderata>Desiderata</a></li></ul></li><li><a href=#eglot>Eglot</a><ul><li><a href=#caveats>Caveats</a></li></ul></li><li><a href=#language-servers>Language Servers</a><ul><li><a href=#c-plus-plus>C++</a></li><li><a href=#python>Python</a></li><li><a href=#bash>Bash</a></li><li><a href=#fortran>Fortran</a></li><li><a href=#nix>Nix</a></li><li><a href=#tex>TeX</a></li></ul></li><li><a href=#local-usage>Local Usage</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>7 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2021-07-20 02:28 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/emacs-lang-servers/>Doom Emacs and Language Servers</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=https://rgoswami.me/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a><ul><li><a href=#desiderata>Desiderata</a></li></ul></li><li><a href=#eglot>Eglot</a><ul><li><a href=#caveats>Caveats</a></li></ul></li><li><a href=#language-servers>Language Servers</a><ul><li><a href=#c-plus-plus>C++</a></li><li><a href=#python>Python</a></li><li><a href=#bash>Bash</a></li><li><a href=#fortran>Fortran</a></li><li><a href=#nix>Nix</a></li><li><a href=#tex>TeX</a></li></ul></li><li><a href=#local-usage>Local Usage</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p><code>doom-emacs</code> as an <code>ssh</code> IDE with <code>TRAMP</code> using <code>eglot</code> and language servers.</p></blockquote><h2 id=background>Background</h2><p>For most of my <code>emacs</code> configuration<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, there normally isn&rsquo;t very much to write about which isn&rsquo;t immediately evident from my <a href=https://dotdoom.rgoswami.me>configuration site</a>. However, since my shift to a MacBook, I have needed to fine tune my existing <code>lsp-mode</code> default setup for <code>TRAMP</code> and this post will cover a little bit of that. Though most of the post is about <code>doom-emacs</code>, it is also applicable to vanilla emacs after porting the snippets over to <code>use-package</code> instead.</p><p>There are two primary methods of interfacing <code>emacs</code> to language servers, <code>eglot</code> and <code>lsp-mode</code>. Not for me to do a full comparison, but some thoughts of the top of my head were:</p><dl><dt><a href=https://github.com/joaotavora/eglot>eglot</a></dt><dd>Feels more minimal, maintained by the author of <code>yassnippet</code></dd><dt><a href=https://github.com/emacs-lsp/lsp-mode/>lsp-mode</a></dt><dd>Much more configuration, better documentation in some aspects, strangely difficult <code>TRAMP</code> setup</dd></dl><p>Note that the comparisons stated are neither fair nor particularly useful. I just need something to work quickly with my main programming languages at the moment. I went with <code>eglot</code>.</p><h3 id=desiderata>Desiderata</h3><p>The things I really need, which both provide are:</p><ul><li>Easily look up doc-strings</li><li>Auto-completion</li><li>Renaming symbols</li><li>Figuring out common mistakes</li><li>Indexing and lookup for symbol definitions and usage</li></ul><h2 id=eglot>Eglot</h2><p>Getting started with <code>eglot</code> was surprisingly pleasant, for <code>doom</code> ships a pretty out-of the box configuration anyway.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=c1>;; init.el</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nv>lsp</span> <span class=nv>+eglot</span><span class=p>)</span> <span class=c1>;; Activate eglot</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nv>python</span> <span class=nv>+lsp</span><span class=p>)</span> <span class=c1>;; Python with pyls by default</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nv>cc</span> <span class=nv>+lsp</span><span class=p>)</span> <span class=c1>;; C++ with clangd by default</span>
</span></span></code></pre></div><p>Usage was pretty sweet (after getting <code>clang-tools</code> for <code>clangd</code>), it can be activated by running <code>eglot</code> in any supported buffer, and it came with all the standard bells and whistles.</p><figure><img src=/ox-hugo/2021-07-19_20-19-38_screenshot.png></figure><p>For working with <code>tramp</code> too, after <code>Emacs 27.1</code>, in most cases it <strong>just works</strong>, one simply needs to supply the location of the language server executable and we&rsquo;re off to the races. In-fact, even adding the full path to the binary to <code>PATH</code> is good enough for <code>eglot</code>.</p><h3 id=caveats>Caveats</h3><ul><li>No <code>projectile</code> support planned (though there <a href=https://github.com/joaotavora/eglot/issues/129>are workarounds</a>)<ul><li>Uses <code>project.el</code> to pick root directories (i.e. <code>.git</code>)<ul><li>In particular this means it works poorly with <code>git</code> sub-modules</li></ul></li></ul></li></ul><p>Overall the main issue with <code>eglot</code> seems to be the insistence to be accepted into <code>emacs</code> core someday. This is great, and a good direction for the project to grow in, but it constrains my workflow unnecessarily. I&rsquo;m more interested in working with <code>doom-emacs</code> than vanilla <code>emacs</code> and so am pretty invested in non-core libraries like <code>projectile</code>¬†<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h2 id=language-servers>Language Servers</h2><p>For getting the language server providers themselves, we will mostly leverage direct binaries where possible, but also, depending on the implementation, virtual environments<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. Essentially we have the following Rosetta stone.</p><div class=table-caption><span class=table-number>Table 1:</span>
Language servers and installation methods</div><table><thead><tr><th><strong>Language</strong></th><th><strong>Server</strong></th><th><strong>Installation</strong></th><th><strong>Management</strong></th></tr></thead><tbody><tr><td>C++</td><td><code>clangd</code></td><td>Manual (binary)</td><td>None</td></tr><tr><td>Python</td><td><code>pylsp</code></td><td><code>pip</code></td><td>Micromamba</td></tr><tr><td>Bash</td><td><code>bash-language-server</code></td><td><code>npm</code></td><td>NVM</td></tr><tr><td>R</td><td><code>languageserver</code></td><td><code>install.packages</code></td><td>N/A</td></tr><tr><td>TeX</td><td><code>digestiff</code></td><td>Manual (wrapper)</td><td>None</td></tr><tr><td>Nix</td><td><code>rnix-lsp</code></td><td>Nix</td><td>N/A</td></tr><tr><td>Fortran</td><td><code>fortran-language-server</code></td><td><code>pip</code></td><td>Micromamba</td></tr></tbody></table><p>So we need to setup the following, assuming an existing <code>conda</code> helper (<code>micromamba</code> as described here) setup.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Get Micromamba</span>
</span></span><span class=line><span class=cl>mkdir -p ~/.local/bin
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$HOME</span>/.local/bin:<span class=nv>$PATH</span>
</span></span><span class=line><span class=cl>wget -qO- https://micromamba.snakepit.net/api/micromamba/linux-64/latest <span class=p>|</span> tar -xvj bin/micromamba
</span></span><span class=line><span class=cl>mv bin/micromamba ~/.local/bin
</span></span><span class=line><span class=cl>rm -rf bin
</span></span><span class=line><span class=cl>micromamba shell init -s bash -p <span class=nv>$HOME</span>/.micromamba
</span></span><span class=line><span class=cl>. ~/.bashrc
</span></span></code></pre></div><p>Now we can use it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>micromamba create -n lsp
</span></span><span class=line><span class=cl>micromamba activate lsp
</span></span><span class=line><span class=cl>micromamba install <span class=nv>python</span><span class=o>==</span>3.9 pip -c conda-forge
</span></span></code></pre></div><p>Note that for this to work out well, we need to activate this environment by default, with something like <code>micromamba activate lsp</code> added to your <code>.bashrc</code>. In fact, it is best to also add the full path, since <code>eglot</code> doesn&rsquo;t seem to pick it up after <code>micromamba activate</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$HOME</span>/.micromamba/envs/lsp/bin/:<span class=nv>$PATH</span>
</span></span></code></pre></div><p>Also, we need to setup <code>nvm</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh <span class=p>|</span> bash
</span></span><span class=line><span class=cl>. <span class=nv>$HOME</span>/.bashrc
</span></span><span class=line><span class=cl>nvm install node
</span></span><span class=line><span class=cl>nvm use node
</span></span></code></pre></div><h3 id=c-plus-plus>C++</h3><p>For <code>clangd</code> (details <a href=https://clangd.llvm.org/installation.html>here</a>) and <code>tramp</code> this amounted to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/.local/lsp
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/.local/lsp
</span></span><span class=line><span class=cl>wget https://github.com/clangd/clangd/releases/download/12.0.0/clangd-linux-12.0.0.zip
</span></span><span class=line><span class=cl>unzip clangd-linux-12.0.0.zip
</span></span><span class=line><span class=cl>mv clangd-linux-12.0.0/* .
</span></span></code></pre></div><p>In combination with the standard <code>doom-emacs</code> <a href=https://github.com/hlissner/doom-emacs/tree/develop/modules/lang/cc>cc module</a>, this is a very good workflow, with the only issue being the ability to set the project root and files to be considered. There is <code>doom-emacs</code> version of appending and setting the language server used, which will be used here:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>after!</span> <span class=nv>eglot</span>
</span></span><span class=line><span class=cl>  <span class=nb>:config</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>set-eglot-client!</span> <span class=ss>&#39;cc-mode</span> <span class=o>&#39;</span><span class=p>(</span><span class=s>&#34;clangd&#34;</span> <span class=s>&#34;-j=3&#34;</span> <span class=s>&#34;--clang-tidy&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span></code></pre></div><p>Note that the best way to make a language server behave is to have a compilation database, which can be generated (for a <code>CMake</code> project) as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># From src</span>
</span></span><span class=line><span class=cl>mkdir build
</span></span><span class=line><span class=cl><span class=nb>cd</span> build
</span></span><span class=line><span class=cl><span class=c1># cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 .. -G &#39;Unix Makefiles&#39; # default on *nix</span>
</span></span><span class=line><span class=cl>cmake -DCMAKE_EXPORT_COMPILE_COMMANDS<span class=o>=</span><span class=m>1</span> .. -G <span class=s1>&#39;Ninja&#39;</span> <span class=c1># way faster</span>
</span></span><span class=line><span class=cl>ninja <span class=c1># or make</span>
</span></span><span class=line><span class=cl>cp compile_commands.json ..
</span></span></code></pre></div><p>This will ensure the best experience, since the <code>compile_commands.json</code> (described <a href=https://clang.llvm.org/docs/JSONCompilationDatabase.html>here</a>) file contains paths to all the files used, including system and write-only files¬†<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. The setup here works well with enough with the <code>ccls</code> language server as well, which in turn is a more maintained fork of <code>cquery</code>.</p><h3 id=python>Python</h3><p>Palantir&rsquo;s <code>python-language-server</code> is EOL, and was <a href=https://github.com/joaotavora/eglot/pull/688>weird to begin with</a>, but the Spyder team has taken up the gauntlet and maintains the <code>python-lsp-server</code> (<a href=https://github.com/python-lsp/python-lsp-server>repo</a>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>micromamba activate lsp <span class=c1># should be done in the ~/.bashrc</span>
</span></span><span class=line><span class=cl>micromamba install python-lsp-server<span class=o>[</span>all<span class=o>]</span> -c conda-forge
</span></span></code></pre></div><p>For working with this in an optimal manner the <code>eglot</code> <a href=https://github.com/joaotavora/eglot>readme</a> suggests using <code>.dir-local.el</code> files. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>((</span><span class=nv>python-mode</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span> <span class=p>((</span><span class=nv>eglot-workspace-configuration</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span> <span class=p>((</span><span class=nb>:pylsp</span> <span class=o>.</span> <span class=p>(</span><span class=nb>:plugins</span> <span class=p>(</span><span class=nb>:jedi_completion</span> <span class=p>(</span><span class=nb>:include_params</span> <span class=no>t</span><span class=p>)))))))))</span>
</span></span></code></pre></div><p>It so happens that this method is flexible enough to allow multi-configuration of servers as well. Additionally, we have options for working with the setup:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>after!</span> <span class=nv>eglot</span>
</span></span><span class=line><span class=cl>  <span class=nb>:config</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>set-eglot-client!</span> <span class=ss>&#39;python-mode</span> <span class=o>&#39;</span><span class=p>(</span><span class=s>&#34;pylsp&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>set-eglot-client!</span> <span class=ss>&#39;cc-mode</span> <span class=o>&#39;</span><span class=p>(</span><span class=s>&#34;clangd&#34;</span> <span class=s>&#34;-j=3&#34;</span> <span class=s>&#34;--clang-tidy&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>Or in vanilla <code>emacs</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>add-to-list</span> <span class=ss>&#39;eglot-server-programs</span>
</span></span><span class=line><span class=cl>             <span class=o>&#39;</span><span class=p>(</span><span class=nv>python-mode</span> <span class=s>&#34;pylsp&#34;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=bash>Bash</h3><p>This is fairly straightforward, and implemented in <code>js</code> <a href=https://github.com/mads-hartmann/bash-language-server>here</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nvm use node
</span></span><span class=line><span class=cl>npm i -g bash-language-server
</span></span></code></pre></div><p>Along with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>sh</span> <span class=nv>+lsp</span><span class=p>)</span> <span class=c1>;; in the init.el file</span>
</span></span></code></pre></div><h3 id=fortran>Fortran</h3><p>The installation of <code>fortls</code> (<a href=https://github.com/hansec/fortran-language-server>repo</a>) is simple enough.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>micromamba activate lsp
</span></span><span class=line><span class=cl>pip install fortran-language-server
</span></span></code></pre></div><p>Unfortunately, <code>doom-emacs</code> does not actually support the <code>fortran</code> language server out of the box, so some additional <code>emacs-lisp</code> needs to go into the configuration.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>add-hook</span> <span class=ss>&#39;f90-mode-hook</span> <span class=ss>&#39;eglot-ensure</span><span class=p>)</span>
</span></span></code></pre></div><p>This works quite well for larger projects.</p><figure><img src=/ox-hugo/2021-07-20_01-23-39_screenshot.png></figure><h3 id=nix>Nix</h3><p><code>rnix-lsp</code> (<a href=https://github.com/nix-community/rnix-lsp>repo</a>) has no non <code>nix</code> installation, and a slightly uncertain future, but it is still fantastic and shouldn&rsquo;t be left out<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nix-env -i -f https://github.com/nix-community/rnix-lsp/archive/master.tar.gz
</span></span><span class=line><span class=cl>nix-env -i nixkpgs-fmt
</span></span></code></pre></div><p>As this is another unsupported server in <code>doom-emacs</code>, the setup needs some tweaking.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>add-hook</span> <span class=ss>&#39;nix-mode-hook</span> <span class=ss>&#39;eglot-ensure</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=tex>TeX</h3><p>The last of the language servers, <code>digestif</code> (<a href=https://github.com/astoff/digestif>repo</a>) is implemented in <code>lua</code>, and probably shouldn&rsquo;t be on a remote machine<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, but nevertheless.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p ~/.local/lsp/bin
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/.local/lsp/bin
</span></span><span class=line><span class=cl>wget https://raw.githubusercontent.com/astoff/digestif/master/scripts/digestif
</span></span><span class=line><span class=cl>chmod +x digestif
</span></span><span class=line><span class=cl>./digestif
</span></span></code></pre></div><p>This sets up <code>$HOME/.digestif/bin</code> which is yet another path to be managed. Note that this assumes a standard <code>TexLive</code> installation with <code>luatex</code>.</p><h2 id=local-usage>Local Usage</h2><p>For local use, assuming similar installation instructions, it is easier to manipulate <code>exec-path</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=line><span class=cl><span class=p>(</span><span class=nv>after!</span> <span class=nv>eglot</span>
</span></span><span class=line><span class=cl>  <span class=nb>:config</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>add-hook</span> <span class=ss>&#39;nix-mode-hook</span> <span class=ss>&#39;eglot-ensure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>add-hook</span> <span class=ss>&#39;f90-mode-hook</span> <span class=ss>&#39;eglot-ensure</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>set-eglot-client!</span> <span class=ss>&#39;cc-mode</span> <span class=o>&#39;</span><span class=p>(</span><span class=s>&#34;clangd&#34;</span> <span class=s>&#34;-j=3&#34;</span> <span class=s>&#34;--clang-tidy&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nv>set-eglot-client!</span> <span class=ss>&#39;python-mode</span> <span class=o>&#39;</span><span class=p>(</span><span class=s>&#34;pylsp&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>when</span> <span class=p>(</span><span class=nv>string=</span> <span class=p>(</span><span class=nf>system-name</span><span class=p>)</span> <span class=s>&#34;blah&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>setq</span> <span class=nv>exec-path</span> <span class=p>(</span><span class=nf>append</span> <span class=nv>exec-path</span> <span class=o>&#39;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                                      <span class=p>(</span><span class=nf>concat</span> <span class=p>(</span><span class=nv>getenv</span> <span class=s>&#34;HOME&#34;</span><span class=p>)</span> <span class=s>&#34;/.micromamba/envs/lsp/bin/&#34;</span><span class=p>)</span> <span class=c1>;; python, fortran</span>
</span></span><span class=line><span class=cl>                                      <span class=p>(</span><span class=nf>concat</span> <span class=p>(</span><span class=nv>getenv</span> <span class=s>&#34;HOME&#34;</span><span class=p>)</span> <span class=s>&#34;/.local/lsp/bin/&#34;</span><span class=p>)</span> <span class=c1>;; clangd</span>
</span></span><span class=line><span class=cl>                                      <span class=p>(</span><span class=nf>concat</span> <span class=p>(</span><span class=nv>getenv</span> <span class=s>&#34;HOME&#34;</span><span class=p>)</span> <span class=s>&#34;/.digestif/bin/&#34;</span><span class=p>)</span> <span class=c1>;; tex</span>
</span></span><span class=line><span class=cl>                                      <span class=p>(</span><span class=nf>concat</span> <span class=p>(</span><span class=nv>getenv</span> <span class=s>&#34;HOME&#34;</span><span class=p>)</span> <span class=s>&#34;/.nvm/versions/node/v16.1.0/bin/bash-language-server&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                      <span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span></code></pre></div><p>Where you will need to replace <code>"blah"</code> with the output of <code>(system-name)</code>.</p><h2 id=conclusions>Conclusions</h2><p>Embarrassingly, neither setup provided as pleasant an SSH based workflow as VS Code. However, that probably has a lot more to do with TRAMP than any of the language servers, and in any case <a href=https://magit.vc/>Magit</a> still makes <code>emacs</code> far superior. In any case, the setup described here is still far superior to not using anything other than <code>projectile</code> and <code>ripgrep</code> so I am satisfied for now. The path setup in this post is deliberately polluting for simplification however, and in practice <a href=https://github.com/HaoZeke/Dotfiles/blob/bombadil/readme.org>my Dotfiles</a> are managed a lot better with <code>bombadil</code> which is something for a later post. Each of these will take some getting used to, and new keybindings will probably be needed, especially for my <a href=https://rgoswami.me/posts/colemak-dots-refactor/>idiomatic Colemak setup</a>.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>More than adequately managed by <code>hlissner</code>&rsquo;s fantastic <a href=https://github.com/hlissner/doom-emacs>doom-emacs</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>If you need more information, Doug Davis has a more <a href=https://ddavis.io/posts/eglot-cpp-ide/>in-depth vanilla emacs write-up</a> on <code>eglot</code> and C++&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>Though my university cluster has <code>nix</code>, most remote machines do not, so we don&rsquo;t depend on it here&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>This means, libraries like <code>Eigen</code> or even the standard library can be looked up via <code>eglot</code>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>The original author <a href=https://www.redox-os.org/news/open-source-mental-health/>unfortunately passed away earlier</a> this year&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>Visualizing the resultant <code>pdf</code> would be a chore&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://rgoswami.me/tags/workflow>workflow</a></span><span class=tag><a href=https://rgoswami.me/tags/projects>projects</a></span><span class=tag><a href=https://rgoswami.me/tags/tools>tools</a></span><span class=tag><a href=https://rgoswami.me/tags/emacs>emacs</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1366 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2021-07-20 02:28 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&url=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20interesting...&body=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f&title=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20interesting...&summary=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20interesting...&source=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f&resubmit=true&title=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22Doom%20Emacs%20and%20Language%20Servers%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2femacs-lang-servers%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://rgoswami.me/posts/nix-channel-nur/><span class=button__icon>‚Üê</span>
<span class=button__text>Nix, Channels and the NUR</span></a></span>
<span class="button next"><a href=https://rgoswami.me/posts/seri-2021-meta/><span class=button__text>Talk Supplements for SERI'21</span>
<span class=button__icon>‚Üí</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><script src=https://utteranc.es/client.js repo=haozeke/haozeke.github.io issue-term=pathname theme=photon-dark label="Utterance üí¨" crossorigin=anonymous async></script></div></main><footer class=footer><p>&copy; 2022
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=https://rgoswami.me/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script>
<script>(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-109503488-16","auto"),ga("send","pageview")</script><script type=text/javascript>(function(e,o,t,i,a,n,s){e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},n=o.createElement(i),n.async=1,n.src="https://www.clarity.ms/tag/"+a,s=o.getElementsByTagName(i)[0],s.parentNode.insertBefore(n,s)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script>
<script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script>
<script src=/js/codefold.min.d0515ab08b3615633a8e8628e085c3c753ffc806b6d58bc2221083be6e9ab17a7a86ac9b4fc772c93a44f5d665dc13e87de3bc389b27c736e2a6a46e0df12f9c.js></script></body></html>