<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="pytorch local development environments without tears, root access or spack dev-build
 Background Build systems are a bit of a nightmare. I spend most of my time SSH&amp;rsquo;ed into more powerful CPU machines, and sometimes on machines with more exotic compute devices. micromamba is typically my poison of choice where nix is not an option.
However, micromamba doesn&amp;rsquo;t allow a whole lot in the way of setting up environments which do not use packages already on conda-forge."><meta name=keywords content=",ramblings,pytorch"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/spack-pytorch-dev-workflow/><title>Spack and PyTorch Development Workflows :: Rohit Goswami â€” Reflections</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.b6dbce0fdf6c61563a0c2226e857d5dadd8e5afa2c4f73ec9ea55abd831f9a72.css><meta itemprop=name content="Spack and PyTorch Development Workflows"><meta itemprop=description content="pytorch local development environments without tears, root access or spack dev-build
 Background Build systems are a bit of a nightmare. I spend most of my time SSH&rsquo;ed into more powerful CPU machines, and sometimes on machines with more exotic compute devices. micromamba is typically my poison of choice where nix is not an option.
However, micromamba doesn&rsquo;t allow a whole lot in the way of setting up environments which do not use packages already on conda-forge."><meta itemprop=datePublished content="2022-04-24T19:16:00+00:00"><meta itemprop=dateModified content="2022-04-24T19:16:00+00:00"><meta itemprop=wordCount content="1428"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="ramblings,pytorch,"><meta property="og:title" content="Spack and PyTorch Development Workflows"><meta property="og:description" content="pytorch local development environments without tears, root access or spack dev-build
 Background Build systems are a bit of a nightmare. I spend most of my time SSH&rsquo;ed into more powerful CPU machines, and sometimes on machines with more exotic compute devices. micromamba is typically my poison of choice where nix is not an option.
However, micromamba doesn&rsquo;t allow a whole lot in the way of setting up environments which do not use packages already on conda-forge."><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/spack-pytorch-dev-workflow/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-24T19:16:00+00:00"><meta property="article:modified_time" content="2022-04-24T19:16:00+00:00"><meta property="og:site_name" content="Rohit Goswami"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="Spack and PyTorch Development Workflows"><meta name=twitter:description content="pytorch local development environments without tears, root access or spack dev-build
 Background Build systems are a bit of a nightmare. I spend most of my time SSH&rsquo;ed into more powerful CPU machines, and sometimes on machines with more exotic compute devices. micromamba is typically my poison of choice where nix is not an option.
However, micromamba doesn&rsquo;t allow a whole lot in the way of setting up environments which do not use packages already on conda-forge."><meta property="article:section" content="notes"><meta property="article:published_time" content="2022-04-24 19:16:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://rgoswami.me/about>About</a></li><li><a href=https://rgoswami.me/posts>Blog</a></li></ul><ul class=menu__inner><li><a href=https://rgoswami.me/categories>Categories</a></li><li><a href=https://rgoswami.me/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=https://rgoswami.me/js/mathjax-config.js></script>
<script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#humble-origins>Humble Origins</a><ul><li><a href=#environments-and-purity>Environments and Purity</a></li></ul></li><li><a href=#basic-anonymous-environments>Basic Anonymous Environments</a><ul><li><a href=#compiler-setups>Compiler Setups</a></li></ul></li><li><a href=#pytorch-local-development>PyTorch Local Development</a><ul><li><a href=#cpu>CPU</a></li><li><a href=#cuda-setup>CUDA Setup</a></li></ul></li><li><a href=#baseline-environment>Baseline Environment</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>7 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2022-04-24 19:16 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/spack-pytorch-dev-workflow/>Spack and PyTorch Development Workflows</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=https://rgoswami.me/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#humble-origins>Humble Origins</a><ul><li><a href=#environments-and-purity>Environments and Purity</a></li></ul></li><li><a href=#basic-anonymous-environments>Basic Anonymous Environments</a><ul><li><a href=#compiler-setups>Compiler Setups</a></li></ul></li><li><a href=#pytorch-local-development>PyTorch Local Development</a><ul><li><a href=#cpu>CPU</a></li><li><a href=#cuda-setup>CUDA Setup</a></li></ul></li><li><a href=#baseline-environment>Baseline Environment</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p><code>pytorch</code> local development environments without tears, root access or <code>spack dev-build</code></p></blockquote><h2 id=background>Background</h2><p>Build systems are a bit of a nightmare. I spend most of my time SSH&rsquo;ed into more
powerful CPU machines, and sometimes on machines with more exotic compute
devices. <code>micromamba</code> is typically my poison of choice where <code>nix</code> is not
an option.</p><p>However, <code>micromamba</code> doesn&rsquo;t allow a whole lot in the way of setting up
environments which do not use packages already on <code>conda-forge</code>. <a href=https://spack.readthedocs.io/en/latest/getting_started.html>Spack</a> fills a
nice niche for such situations<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. Additionally, it can be coerced
into use for local development and the same cannot easily be said of <code>conda</code>
based workflows.</p><h2 id=humble-origins>Humble Origins</h2><p>We&rsquo;ll start from scratch, grabbing <code>spack</code> and bootstrapping <code>clingo</code> for its
dependency resolution as per <a href=https://spack.readthedocs.io/en/latest/getting_started.html>the documentation</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>git clone -c feature.manyFiles<span class=o>=</span><span class=nb>true</span> https://github.com/spack/spack.git
</span></span><span class=line><span class=ln>2</span><span class=cl>. spack/share/spack/setup-env.sh <span class=c1># Assumes zsh || bash</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>spack spec zlib <span class=c1># Or anything really</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>spack --bootstrap find <span class=c1># Should have clingo</span>
</span></span></code></pre></div><h3 id=environments-and-purity>Environments and Purity</h3><p>Unlike <code>nix</code>, <code>spack</code> does not offer strong guarantees of purity. There are
primarily two approaches to using environments in <code>spack</code>, somewhat analogously
to the <code>conda</code> environment logic.</p><dl><dt><strong>Named Environments</strong></dt><dd>These are essentially equivalent to <code>conda</code> environments, and can be activated and deactivated at will. However, the folder structure in this case, along with the dependencies are localized within <code>$SPACK_HOME/var/spack/environments/$ENV_NAME</code></dd><dt><strong>Anonymous Environments</strong></dt><dd>These can be setup inside any directory, and can be activated but not deactivated (<code>despacktivate</code> will not work). These are useful for development environments.</dd></dl><p>We will use both kinds of environments. Additionally, <code>spack</code> supports multiple
<code>variants</code> which can be queried by <code>spack info $PKG_NAME</code>. These are used to
support various build configurations while providing a unified interface build
through <code>spack install</code>.</p><h2 id=basic-anonymous-environments>Basic Anonymous Environments</h2><p>For starters we will need to setup a development environment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>mkdir spackPyTorch
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nb>cd</span> spackPyTorch
</span></span><span class=line><span class=ln>3</span><span class=cl>spack env create -d .
</span></span></code></pre></div><p>To ensure that the dependencies are resolved consistently, the <code>concretization</code>
option to needs to be set to <code>together</code>. We will start by adding some packages.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack -e . add py-ipython
</span></span><span class=line><span class=ln>2</span><span class=cl>spack -e . config edit <span class=c1># Make changes</span>
</span></span></code></pre></div><p>For ease of manual customization, it is best to lightly edit the <code>spack.yaml</code>
file to have each dependency on its own line. At this point a bare-minimum
near-empty environment is ready.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>spack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w>  </span><span class=nt>specs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w>    </span>- <span class=l>py-ipython</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=nt>view</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>5</span><span class=cl><span class=w>  </span><span class=nt>concretization</span><span class=p>:</span><span class=w> </span><span class=l>together</span><span class=w>
</span></span></span></code></pre></div><p>To ensure dependencies are resolved simultaneously, <code>concretize</code> is set to
<code>together</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack -e . concretize <span class=c1># doesn&#39;t install</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>spack -e . install
</span></span><span class=line><span class=ln>3</span><span class=cl>spack env activate . <span class=c1># or spacktivate .</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1># Can also use the fully qualified path instead of .</span>
</span></span></code></pre></div><p>Recall that changes are propagated via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack -e . concretize --force
</span></span><span class=line><span class=ln>2</span><span class=cl>spack -e . install
</span></span></code></pre></div><p>This establishes baseline environments, but precludes setting up development
workflows. Most packages can be included as described above, with the exception
of compiler toolchains.</p><h3 id=compiler-setups>Compiler Setups</h3><p>Setting up compiler toolchains like a <code>fortran</code> compiler (perhaps for
<code>openblas</code>) can take a bit more effort. Although this discussion will focus on
obtaining a <code>fortran</code> compiler it is equally applicable to updating a version.
For <code>spack</code>, unlike many system package managers, <code>gcc</code> will install the <code>C</code>,
<code>C++</code> and <code>Fortran</code> toolchains. Thus:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># outside the spack environment</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>spack install gcc@11.2.0 <span class=c1># will take a while</span>
</span></span></code></pre></div><p>Now we need to let <code>spack</code> register this compiler.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack compiler find <span class=k>$(</span>spack location -i gcc@11.2.0<span class=k>)</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>spack compilers <span class=c1># should now list GCC 11.2.0</span>
</span></span></code></pre></div><p>Finally we can edit our <code>spack.yml</code> environment to reflect the new compiler toolchain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nt>spack</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>2</span><span class=cl><span class=w>  </span><span class=nt>definitions</span><span class=p>:</span><span class=w>
</span></span></span><span class="line hl"><span class=ln>3</span><span class=cl><span class=w>    </span>- <span class=nt>compilers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gcc@11.2.0]</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w>  </span><span class=nt>specs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w>    </span>- <span class=l>py-ipython</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w>  </span><span class=nt>view</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w>  </span><span class=nt>concretization</span><span class=p>:</span><span class=w> </span><span class=l>together</span><span class=w>
</span></span></span></code></pre></div><p>One of the nicer parts of <code>spack</code> being an HPC environment management tool is
that there is first-class support for proprietary compiler toolchains like Intel
and families of compilers can also be specified with the <code>%intel</code> syntax as
well. Much <a href=https://spack-tutorial.readthedocs.io/en/latest/tutorial_configuration.html#yaml-format>more fine-tuning</a> is also possible including registering system
compilers if required.</p><h2 id=pytorch-local-development>PyTorch Local Development</h2><p>One of the caveats of local development with <code>spack</code> is that the base URL needs
to be updated from within the local copy of <code>spack</code>. This means editing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>vim <span class=nv>$SPACK_ROOT</span>/var/spack/repos/builtin/packages/py-torch/package.py <span class=c1># edit</span>
</span></span></code></pre></div><p>The patch is minimally complicated, for a fork and a working branch like <code>npeye</code>
it would look like this diff:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=ln> 1</span><span class=cl><span class=gh>diff --git a/var/spack/repos/builtin/packages/py-torch/package.py b/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=gh>index 8190e01102..c276009d10 100644
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=gh></span><span class=gd>--- a/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=gd></span><span class=gi>+++ b/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=gi></span><span class=gu>@@ -14,7 +14,7 @@ class PyTorch(PythonPackage, CudaPackage):
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=gu></span>     with strong GPU acceleration.&#34;&#34;&#34;
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>     homepage = &#34;https://pytorch.org/&#34;
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=gd>-    git      = &#34;https://github.com/pytorch/pytorch.git&#34;
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=gd></span><span class=gi>+    git      = &#34;https://github.com/HaoZeke/pytorch.git&#34;
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=gi></span>
</span></span><span class=line><span class=ln>12</span><span class=cl>     maintainers = [&#39;adamjstewart&#39;]
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=gu>@@ -22,6 +22,7 @@ class PyTorch(PythonPackage, CudaPackage):
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=gu></span>     # core libraries to ensure that the package was successfully installed.
</span></span><span class=line><span class=ln>16</span><span class=cl>     import_modules = [&#39;torch&#39;, &#39;torch.autograd&#39;, &#39;torch.nn&#39;, &#39;torch.utils&#39;]
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=gi>+    version(&#39;npeye&#39;, branch=&#39;npeye&#39;, submodules=True)
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=gi></span>     version(&#39;master&#39;, branch=&#39;master&#39;, submodules=True)
</span></span><span class=line><span class=ln>20</span><span class=cl>     version(&#39;1.11.0&#39;, tag=&#39;v1.11.0&#39;, submodules=True)
</span></span><span class=line><span class=ln>21</span><span class=cl>     version(&#39;1.10.2&#39;, tag=&#39;v1.10.2&#39;, submodules=True)
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=gu>@@ -348,7 +349,8 @@ def enable_or_disable(variant, keyword=&#39;USE&#39;, var=None, newer=False):
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=gu></span>         elif &#39;~onnx_ml&#39; in self.spec:
</span></span><span class=line><span class=ln>24</span><span class=cl>             env.set(&#39;ONNX_ML&#39;, &#39;OFF&#39;)
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=gd>-        if not self.spec.satisfies(&#39;@master&#39;):
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=gd></span><span class=gi>+        if not (self.spec.satisfies(&#39;@master&#39;) or
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=gi>+                self.spec.satisfies(&#39;@npeye&#39;)):
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=gi></span>             env.set(&#39;PYTORCH_BUILD_VERSION&#39;, self.version)
</span></span><span class=line><span class=ln>30</span><span class=cl>             env.set(&#39;PYTORCH_BUILD_NUMBER&#39;, 0)
</span></span></code></pre></div><p>Applying such a patch is straightforward.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> <span class=nv>$SPACK_ROOT</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># Assuming it is named pytorchspack.diff</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>git apply pytorchspack.diff
</span></span></code></pre></div><p>This modified environment can now be enabled for use with the appropriate
variants (details found with <code>spack info py-torch</code>).
However, there is one rather important variant missing for local development,
<code>DEBUG</code>. The application of this patch will rectify this until an upstream PR is
merged.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=ln> 1</span><span class=cl><span class=gh>diff --git a/var/spack/repos/builtin/packages/py-torch/package.py b/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=gh>index 8190e01102..d7b68ae4bd 100644
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=gh></span><span class=gd>--- a/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=gd></span><span class=gi>+++ b/var/spack/repos/builtin/packages/py-torch/package.py
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=gi></span><span class=gu>@@ -49,6 +49,7 @@ class PyTorch(PythonPackage, CudaPackage):
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=gu></span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>     # All options are defined in CMakeLists.txt.
</span></span><span class=line><span class=ln> 8</span><span class=cl>     # Some are listed in setup.py, but not all.
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=gi>+    variant(&#39;debug&#39;, default=False, description=&#34;Build with debugging support&#34;)
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=gi></span>     variant(&#39;caffe2&#39;, default=True, description=&#39;Build Caffe2&#39;, when=&#39;@1.7:&#39;)
</span></span><span class=line><span class=ln>11</span><span class=cl>     variant(&#39;test&#39;, default=False, description=&#39;Build C++ test binaries&#39;)
</span></span><span class=line><span class=ln>12</span><span class=cl>     variant(&#39;cuda&#39;, default=not is_darwin, description=&#39;Use CUDA&#39;)
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=gu>@@ -343,6 +344,12 @@ def enable_or_disable(variant, keyword=&#39;USE&#39;, var=None, newer=False):
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=gu></span>         enable_or_disable(&#39;gloo&#39;, newer=True)
</span></span><span class=line><span class=ln>15</span><span class=cl>         enable_or_disable(&#39;tensorpipe&#39;)
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=gi>+        if &#39;+debug&#39; in self.spec:
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=gi>+            env.set(&#39;DEBUG&#39;, 1)
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=gi>+        elif &#39;-debug&#39; or &#39;~debug&#39; in self.spec:
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=gi>+            env.set(&#39;DEBUG&#39;, &#39;0&#39;)
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=gi>+
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=gi>+
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=gi></span>         if &#39;+onnx_ml&#39; in self.spec:
</span></span><span class=line><span class=ln>24</span><span class=cl>             env.set(&#39;ONNX_ML&#39;, &#39;ON&#39;)
</span></span><span class=line><span class=ln>25</span><span class=cl>         elif &#39;~onnx_ml&#39; in self.spec:
</span></span></code></pre></div><p>All together now the variants can be used in conjunction with the development
branch. To focus on the <code>pytorch</code> workflow, we will unpin <code>python@3.10</code> and add
<code>ipython</code> instead.</p><h3 id=cpu>CPU</h3><p>Normally, for a CPU build we would setup something like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nv>DEBUG</span><span class=o>=</span><span class=m>1</span> <span class=nv>USE_DISTRIBUTED</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_MKLDNN</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_CUDA</span><span class=o>=</span><span class=m>0</span> <span class=nv>BUILD_TEST</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_FBGEMM</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_NNPACK</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_QNNPACK</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_XNNPACK</span><span class=o>=</span><span class=m>0</span> <span class=nv>BUILD_CAFFE2</span><span class=o>=</span><span class=m>0</span> <span class=nv>USE_KINETO</span><span class=o>=</span><span class=m>0</span> python setup.py develop
</span></span></code></pre></div><p>The rationale behind the build flags can be found in the <a href=https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md>upstream contributing
guide</a>. In an appropriately defined environment. For us, this translates to
(with the patch added for <code>debug</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spacktivate .
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># CPU only, disable cuda</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1># Also disable a bunch of optionals</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>spack add py-torch@npeye -cuda -fbgemm -nnpack -mkldnn -test -qnnpack +debug
</span></span><span class=line><span class=ln>5</span><span class=cl>spack concretize -f
</span></span></code></pre></div><p>However, we need to also register this package for development (with the branch
setup previously), which is accomplished by:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack develop py-torch@npeye -cuda -fbgemm -nnpack -mkldnn -test -qnnpack +debug
</span></span></code></pre></div><p>This generates a sub-directory <code>py-torch</code> with the right branch checked out,
along with the dependencies needed for the build. Additionally, the
<code>python</code> version is also localized to the <code>spack</code> installation spec.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>spack install <span class=c1># concretizes and installs</span>
</span></span></code></pre></div><p>If additional dependencies are required for testing or other purposes, they are
easily obtained. After making changes <code>spack install</code> will rebuild with the
appropriate flags.</p><h3 id=cuda-setup>CUDA Setup</h3><p>The good news is that updating the build system to use CUDA is very
straightforward. While changing variants, it is occasionally necessary to
forcibly clear out the cache.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> py-torch
</span></span><span class=line><span class=ln>2</span><span class=cl>rm -rf build
</span></span><span class=line><span class=ln>3</span><span class=cl>python setup.py clean
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1># More extreme cases</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>git submodule deinit -f .
</span></span><span class=line><span class=ln>6</span><span class=cl>git clean -xdf
</span></span><span class=line><span class=ln>7</span><span class=cl>python setup.py clean
</span></span><span class=line><span class=ln>8</span><span class=cl>git submodule update --init --recursive --jobs <span class=m>0</span>
</span></span><span class=line><span class=ln>9</span><span class=cl>python setup.py develop
</span></span></code></pre></div><p>We will require the CUDA version to install the appropriate tool-chain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>export</span> <span class=nv>NVCC_CUDA_VERSION</span><span class=o>=</span><span class=k>$(</span>nvidia-smi -q <span class=p>|</span> awk -F<span class=s1>&#39;: &#39;</span> <span class=s1>&#39;/CUDA Version/ {print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>spack add cuda@<span class=nv>$NVCC_CUDA_VERSION</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>spack concretize --force
</span></span><span class=line><span class=ln>4</span><span class=cl>spack install
</span></span></code></pre></div><p>Finally we update the <code>spack.yaml</code> to reflect our new changes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>spack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w>  </span><span class=nt>definitions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span>- <span class=nt>compilers</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gcc@11.2.0]</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=c># add package specs to the `specs` list</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span><span class=nt>specs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span>- <span class=l>py-ipython</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span>- <span class=l>cuda@11.3</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span>- <span class=l>py-torch@npeye+cuda+debug~fbgemm~mkldnn~nnpack~qnnpack~test</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span><span class=nt>view</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>concretization</span><span class=p>:</span><span class=w> </span><span class=l>together</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>  </span><span class=nt>develop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>py-torch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span><span class=nt>spec</span><span class=p>:</span><span class=w> </span><span class=l>py-torch@npeye+cuda+debug~fbgemm~mkldnn~nnpack~qnnpack~test</span><span class=w>
</span></span></span></code></pre></div><p>Which now works seamlessly with <code>spack install</code>.</p><h2 id=baseline-environment>Baseline Environment</h2><p>Finally, to test changes against the main branch upstream, it is useful to
define an environment for the same. This can be named since it allows for better
usage semantics with <code>deactivate</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>spack env create pytorchBaseline
</span></span><span class=line><span class=ln> 2</span><span class=cl>spack -e pytorchBaseline add py-torch@master -cuda -fbgemm -nnpack -mkldnn -test -qnnpack
</span></span><span class=line><span class=ln> 3</span><span class=cl>spack -e pytorchBaseline add py-ipython
</span></span><span class=line><span class=ln> 4</span><span class=cl>spack -e pytorchBaseline config edit
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># Add compilers, concretization</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>spacktivate pytorchBaseline
</span></span><span class=line><span class=ln> 7</span><span class=cl>spack concretize --force
</span></span><span class=line><span class=ln> 8</span><span class=cl>spack install
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># Do tests, compare</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># Wrap up and deactivate</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>despacktivate pytorchBaseline
</span></span></code></pre></div><h2 id=conclusions>Conclusions</h2><p>Dependency management is always painful. CUDA management doubly so. Better
workflows with <a href=https://spack-tutorial.readthedocs.io/en/sc20/tutorial_developer_workflows.html>spack dev-build</a> are available for some packages, <a href=https://github.com/kokkos/kokkos/blob/master/Spack.md>like KOKKOS</a>, but
<code>spack dev-build</code> doesn&rsquo;t work yet for <code>pytorch</code>, and also appears to be removed
from the present set of tutorials. Personally, I&rsquo;d still prefer <code>nix</code>, but where
<code>micromamba</code> falls short in terms of source builds, <code>spack</code> is a good
alternative, if one has the resources to rebuild everything needed.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>It also integrates nicely with typical HPC modular workflows like LMod and has reasonable support for Windows&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://rgoswami.me/tags/ramblings>ramblings</a></span><span class=tag><a href=https://rgoswami.me/tags/pytorch>pytorch</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1428 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2022-04-24 19:16 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&url=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20interesting...&body=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f&title=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20interesting...&summary=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20interesting...&source=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f&resubmit=true&title=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22Spack%20and%20PyTorch%20Development%20Workflows%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2fspack-pytorch-dev-workflow%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://rgoswami.me/posts/tinyssh-dockerdev-env/><span class=button__text>TinySSH for Docker Development Environments</span>
<span class=button__icon>â†’</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><script src=https://utteranc.es/client.js repo=haozeke/haozeke.github.io issue-term=pathname theme=photon-dark label="Utterance ðŸ’¬" crossorigin=anonymous async></script></div></main><footer class=footer><p>&copy; 2022
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=https://rgoswami.me/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script>
<script>(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-109503488-16","auto"),ga("send","pageview")</script><script type=text/javascript>(function(e,o,t,i,a,n,s){e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},n=o.createElement(i),n.async=1,n.src="https://www.clarity.ms/tag/"+a,s=o.getElementsByTagName(i)[0],s.parentNode.insertBefore(n,s)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script>
<script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script>
<script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script>
<script src=/js/codefold.min.d0515ab08b3615633a8e8628e085c3c753ffc806b6d58bc2221083be6e9ab17a7a86ac9b4fc772c93a44f5d665dc13e87de3bc389b27c736e2a6a46e0df12f9c.js></script></body></html>