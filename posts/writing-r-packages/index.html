<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="Some thoughts on melding R with lower level languages and package management
Background I like plotting with ggplot2. It makes more sense to me than the other plotting systems. These notes arose while binding readCon and potlib for cuh2vizR. However, for best practices, my fastMatMR project should be consulted.
Idiosyncracies I find it odd that R packages commit so much generated code Can be simplified with a CI bot Repo setup pixi with renv turns out to be surprisingly robust."><meta name=keywords content="personal,r,cpp,bindings,packaging"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/writing-r-packages/><meta name=generator content="Wooframework"><title>Writing R Packages :: Rohit Goswami ‚Äî Reflections
</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.054e30538b054b321af6575a7659f551cec63e1cef6bbd674acccadf856d3aff.css><meta itemprop=name content="Writing R Packages"><meta itemprop=description content="Some thoughts on melding R with lower level languages and package management
Background I like plotting with ggplot2. It makes more sense to me than the other plotting systems. These notes arose while binding readCon and potlib for cuh2vizR. However, for best practices, my fastMatMR project should be consulted.
Idiosyncracies I find it odd that R packages commit so much generated code Can be simplified with a CI bot Repo setup pixi with renv turns out to be surprisingly robust."><meta itemprop=datePublished content="2023-11-10T18:50:00+00:00"><meta itemprop=dateModified content="2023-11-10T18:50:00+00:00"><meta itemprop=wordCount content="964"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="r,cpp,bindings,packaging,"><meta property="og:title" content="Writing R Packages"><meta property="og:description" content="Some thoughts on melding R with lower level languages and package management
Background I like plotting with ggplot2. It makes more sense to me than the other plotting systems. These notes arose while binding readCon and potlib for cuh2vizR. However, for best practices, my fastMatMR project should be consulted.
Idiosyncracies I find it odd that R packages commit so much generated code Can be simplified with a CI bot Repo setup pixi with renv turns out to be surprisingly robust."><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/writing-r-packages/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-10T18:50:00+00:00"><meta property="article:modified_time" content="2023-11-10T18:50:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="Writing R Packages"><meta name=twitter:description content="Some thoughts on melding R with lower level languages and package management
Background I like plotting with ggplot2. It makes more sense to me than the other plotting systems. These notes arose while binding readCon and potlib for cuh2vizR. However, for best practices, my fastMatMR project should be consulted.
Idiosyncracies I find it odd that R packages commit so much generated code Can be simplified with a CI bot Repo setup pixi with renv turns out to be surprisingly robust."><meta property="article:section" content="notes"><meta property="article:published_time" content="2023-11-10 18:50:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li><li><a href=/series>Series</a></li></ul><ul class=menu__inner><li><a href=/categories>Categories</a></li><li><a href=/snippets>Snippets</a></li><li><a href=/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=/js/mathjax-config.js></script><script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#idiosyncracies>Idiosyncracies</a></li><li><a href=#repo-setup>Repo setup</a><ul><li><a href=#renv-package-development><code>renv</code> package development</a></li></ul></li><li><a href=#stylistic-decisions>Stylistic decisions</a><ul><li><a href=#pre-commit-hooks>Pre-commit hooks</a></li><li><a href=#ropensci-package-check>ROpenSci package check</a></li></ul></li><li><a href=#using-cpp11>Using <code>cpp11</code></a></li><li><a href=#appeasing-pkgcheck>Appeasing <code>pkgcheck</code></a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>5 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2023-11-10 18:50 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/writing-r-packages/>Writing R Packages</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#idiosyncracies>Idiosyncracies</a></li><li><a href=#repo-setup>Repo setup</a><ul><li><a href=#renv-package-development><code>renv</code> package development</a></li></ul></li><li><a href=#stylistic-decisions>Stylistic decisions</a><ul><li><a href=#pre-commit-hooks>Pre-commit hooks</a></li><li><a href=#ropensci-package-check>ROpenSci package check</a></li></ul></li><li><a href=#using-cpp11>Using <code>cpp11</code></a></li><li><a href=#appeasing-pkgcheck>Appeasing <code>pkgcheck</code></a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p>Some thoughts on melding <code>R</code> with lower level languages and package management</p></blockquote><h2 id=background>Background</h2><p>I like plotting with <code>ggplot2</code>. It makes more sense to me than the other
plotting systems. These notes arose while binding <a href=https://github.com/HaoZeke/readCon>readCon</a> and <a href=https://github.com/TheochemUI/potlib>potlib</a> for
<a href=https://github.com/HaoZeke/cuh2vizR>cuh2vizR</a>. However, for best practices, my <a href=https://github.com/ropensci/fastMatMR>fastMatMR</a> project should be consulted.</p><h2 id=idiosyncracies>Idiosyncracies</h2><ul><li>I find it odd that <code>R</code> packages commit so much generated code<ul><li>Can be simplified with a CI bot</li></ul></li></ul><h2 id=repo-setup>Repo setup</h2><p><code>pixi</code> with <code>renv</code> turns out to be surprisingly robust. I normally begin with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>echo</span> <span class=s2>&#34;.pixi/&#34;</span> &gt; .gitignore
</span></span><span class=line><span class=ln>2</span><span class=cl>gibo dump R C++ <span class=p>|</span> cat &gt;&gt; .gitignore
</span></span><span class=line><span class=ln>3</span><span class=cl>pixi init
</span></span><span class=line><span class=ln>4</span><span class=cl>pixi add radian r-renv compilers
</span></span><span class=line><span class=ln>5</span><span class=cl>git add .
</span></span><span class=line><span class=ln>6</span><span class=cl>git commit -m <span class=s2>&#34;PRJ: Let there be light&#34;</span>
</span></span></code></pre></div><p>The rest of the preliminaries can take place within the context of <code>renv</code> and
<code>pixi shell</code>. I tend to leave <code>LICENSE</code> and other templates to <code>usethis</code>.</p><h3 id=renv-package-development><code>renv</code> package development</h3><p>This is fairly straightforward, but takes a while to run, from the <code>radian</code>
terminal (after <code>pixi-shell</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>renv</span><span class=o>::</span><span class=nf>init</span><span class=p>()</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nf>install.packages</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;devtools&#34;</span><span class=p>))</span> <span class=c1># can take a while</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>create_package</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>)</span> <span class=c1># from $GITROOT</span>
</span></span></code></pre></div><p>Now we can start with the rest of the templates.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>use_mit_license</span><span class=p>()</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>use_readme_rmd</span><span class=p>()</span>
</span></span></code></pre></div><div class="warning-alert alert"><div class=alert-heading><p><strong>Warning</strong></p></div><p>CRAN doesn&rsquo;t like fixed dependencies, see <a href=https://github.com/ropensci-review-tools/pkgcheck/issues/149>the discussion here</a>, and often for
developing packages one might not need <code>renv</code> though it still makes sense if one
has multiple development machines. This turned out to be something I regretted,
though <code>pixi</code> is still useful.</p></div><h2 id=stylistic-decisions>Stylistic decisions</h2><p>Always a good idea to lint and style from the get-go, so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=nf>install.packages</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;lintr&#34;</span><span class=p>,</span> <span class=s>&#34;styler&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>Also remember to add <code>.pixi/</code> to <code>.Rbuildignore</code> otherwise local checks will
parse the entire contents of the rather substantial folder.</p><h3 id=pre-commit-hooks>Pre-commit hooks</h3><p>For my packages, I tend to use a <code>pre-commit-hook</code> configured with <code>.pre-commit-config.yaml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>repos</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span>- <span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>https://github.com/pre-commit/pre-commit-hooks</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span><span class=nt>rev</span><span class=p>:</span><span class=w> </span><span class=l>v4.4.0</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>trailing-whitespace</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>    </span><span class=nt>exclude</span><span class=p>:</span><span class=w> </span><span class=l>^(.lintr)</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>end-of-file-fixer</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>check-yaml</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>check-added-large-files</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w></span>- <span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>https://github.com/pre-commit/mirrors-clang-format</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>  </span><span class=nt>rev</span><span class=p>:</span><span class=w> </span><span class=l>v16.0.6</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>  </span><span class=nt>hooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>clang-format</span><span class=w>
</span></span></span></code></pre></div><p>Which can be used via:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># Check</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>pipx run pre-commit run -a
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1># Install</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>pipx run pre-commit install
</span></span></code></pre></div><p>Also worth noting is the CI configuration for the same especially useful for
contributors, <code>.github/workflows/pre-commit.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pre-commit</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main]</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>  </span><span class=nt>pre-commit</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-python@v3</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>      </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>        </span><span class=nt>python-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.11&#39;</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>    </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>pre-commit/action@v2.0.3</span><span class=w>
</span></span></span></code></pre></div><p>However, sometimes <code>pre-commit</code> for <code>R</code> can be flakey. In such situations consider:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>find . <span class=se>\(</span> -path <span class=s2>&#34;./.pixi&#34;</span> -o -path <span class=s2>&#34;./renv&#34;</span> <span class=se>\)</span> -prune -o -type f -name <span class=s2>&#34;*.R&#34;</span> -exec Rscript -e <span class=s1>&#39;library(styler); style_file(&#34;{}&#34;)&#39;</span> <span class=se>\;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>Rscript -e <span class=s1>&#39;library(lintr); lintr::lint_package(&#34;.&#34;)&#39;</span>
</span></span></code></pre></div><p>In any case, always remember to run <code>renv::snapshot()</code> after an
<code>install.packages</code> call.</p><h3 id=ropensci-package-check>ROpenSci package check</h3><div class="warning-alert alert"><div class=alert-heading><p><strong>Warning</strong></p></div><p>This is <strong>really</strong> slow locally, but required in the <code>renv</code> workflow. Still annoying to run locally!</p></div><p>We need to install this with a non-CRAN <a href=https://docs.ropensci.org/pkgcheck/>source</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=nf>options </span><span class=p>(</span><span class=n>repos</span> <span class=o>=</span> <span class=nf>c </span><span class=p>(</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>        <span class=n>ropenscireviewtools</span> <span class=o>=</span> <span class=s>&#34;https://ropensci-review-tools.r-universe.dev&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>        <span class=n>CRAN</span> <span class=o>=</span> <span class=s>&#34;https://cloud.r-project.org&#34;</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=p>))</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=nf>install.packages</span><span class=p>(</span><span class=s>&#34;pkgcheck&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>When its finally done, add the CI configuration.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln> 1</span><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ROpenSci pkg-check</span><span class=w>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=w>      </span>- <span class=l>main</span><span class=w>
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=w>  </span><span class=nt>pkgcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v3</span><span class=w>
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;recursive&#34;</span><span class=w>
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pkgcheck</span><span class=w>
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>ropensci-review-tools/pkgcheck-action@v1.0.0</span><span class=w>
</span></span></span></code></pre></div><h2 id=using-cpp11>Using <code>cpp11</code></h2><p>Even after <code>usethis::use_package("cpp11")</code> one must link to it explicitly in the <code>DESCRIPITON</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=w> </span><span class=nt>SystemRequirements</span><span class=p>:</span><span class=w> </span><span class=l>C++17</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w> </span><span class=nt>Encoding</span><span class=p>:</span><span class=w> </span><span class=l>UTF-8</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w> </span><span class=nt>Roxygen</span><span class=p>:</span><span class=w> </span><span class=l>list(markdown = TRUE)</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w> </span><span class=nt>RoxygenNote</span><span class=p>:</span><span class=w> </span><span class=m>7.2.3</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span><span class=nt>+LinkingTo</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span><span class=l>+    cpp11</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w> </span><span class=nt>Imports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=w>     </span><span class=l>cpp11</span><span class=w>
</span></span></span></code></pre></div><p>One of the other things which tripped me up is that the functions are not
automatically exported, and so one needs to create, in <code>R/$PKGNAME-package.R</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=c1>## usethis namespace: start</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1>#&#39; @useDynLib your-package-name, .registration = TRUE</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1>## usethis namespace: end</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=c1>#&#39; @export func-name-from-cpp11.R</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=kc>NULL</span>
</span></span></code></pre></div><p>Finally, in most cases I found <code>devtools::load_all()</code> to be a bit insufficient, had to use the more complete:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>devtools</span><span class=o>::</span><span class=nf>clean_dll</span><span class=p>()</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>cpp11</span><span class=o>::</span><span class=nf>cpp_register</span><span class=p>()</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=n>devtools</span><span class=o>::</span><span class=nf>document</span><span class=p>()</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=n>devtools</span><span class=o>::</span><span class=nf>load_all</span><span class=p>()</span>
</span></span></code></pre></div><p>I never understood why the <code>R</code> community commits so many generated files, personally I like to prepend my <code>gitignore</code> with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>## Generated files
</span></span><span class=line><span class=ln>2</span><span class=cl>R/cpp11.R
</span></span><span class=line><span class=ln>3</span><span class=cl>src/cpp11.cpp
</span></span><span class=line><span class=ln>4</span><span class=cl>man/
</span></span></code></pre></div><div class="warning-alert alert"><div class=alert-heading><p><strong>Warning</strong></p></div><p>Sadly the entire <code>R</code> ecosystem of checks will fail with this, so a first approximation committing everything might make some sense..</p></div><p>Later, a bot or CI action can be used to populate a &ldquo;full&rdquo; branch of the
repository without muddying my nice <code>git</code> history. In fact, some of these are
actually already part of the set of <a href=https://github.com/r-lib/actions/tree/v2/examples>Github Actions</a> supported by <code>usethis::</code>. I
ended up with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>use_github_action</span><span class=p>()</span> <span class=c1>## Basic, smoke test</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>use_github_action</span><span class=p>(</span><span class=s>&#34;check-standard&#34;</span><span class=p>)</span> <span class=c1>## Overwrite older</span>
</span></span></code></pre></div><p>I was also initially thrown by the requirement of including copies of source
code. I suspect this might be bypassed by using <code>meson</code> as I have in <code>cuh2vizR</code>,
unless CRAN packages are built without internet access. It would make it much
easier to handle updates if <code>meson</code> were to handle setting up the dependencies,
however, it isn&rsquo;t exactly part of <code>R-tools</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><h2 id=appeasing-pkgcheck>Appeasing <code>pkgcheck</code></h2><p>Some thoughts:</p><ul><li>No <code>renv</code> in <code>.Rprofile</code></li><li>Use <code>codemetar</code> to get a <code>codemeta.json</code></li><li>Add a <code>CONTRIBUTING.md</code> (e.g. here)<ul><li>Not strictly necessary but I also go with a <code>CODE_OF_CONDUCT.md</code> (e.g. here)</li></ul></li></ul><p>Personally I needed some <code>tex</code> updates:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>tlmgr install collection-latexrecommended
</span></span><span class=line><span class=ln>2</span><span class=cl>tlmgr install collection-fontsrecommended
</span></span></code></pre></div><p>Always best to include a <code>.covrignore</code> but when in a pinch, this will work:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>covr</span><span class=o>::</span><span class=nf>package_coverage</span><span class=p>(</span><span class=n>line_exclusions</span><span class=o>=</span><span class=nf>file.path</span><span class=p>(</span><span class=s>&#34;.pixi&#34;</span><span class=p>,</span> <span class=nf>list.files</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=s>&#34;.pixi&#34;</span><span class=p>,</span> <span class=n>recursi</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=n>ve</span><span class=o>=</span><span class=bp>T</span><span class=p>)))</span>
</span></span></code></pre></div><p>Also useful was:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-R data-lang=R><span class=line><span class=ln>1</span><span class=cl><span class=n>usethis</span><span class=o>::</span><span class=nf>use_build_ignore</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;newsfragments/&#34;</span><span class=p>,</span> <span class=s>&#34;pixi.*&#34;</span><span class=p>,</span> <span class=s>&#34;CONTRIBUTING.md&#34;</span><span class=p>,</span> <span class=s>&#34;CODE_OF_CONDUCT.md&#34;</span><span class=p>,</span> <span class=s>&#34;.covrignore&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>It is also important, for benchmarking and other long running vignettes, to have
them cached or precomputed, as detailed in <a href=https://www.kloppenborg.ca/2021/06/long-running-vignettes/>this blog post</a> which in turn
references an <a href=https://ropensci.org/blog/2019/12/08/precompute-vignettes/>older ROpenSci post</a>. Vignette images are a whole other beast,
nicely <a href=https://www.jumpingrivers.com/blog/knitr-rmarkdown-image-size/>covered here</a>.</p><h2 id=conclusions>Conclusions</h2><p>These were my rough notes while developing guidelines during the first release
of <a href=https://github.com/ropensci/fastMatMR>fastMatMR</a>. There were additional changes to my packages, mostly in terms of
making them more in keeping with the <code>R</code> community expectations and best
practices. I went through the <code>ROpenSci</code> process and eventually also released to
<code>CRAN</code>, but will cover that in a follow-up.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Yet.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=/tags/r>r</a></span><span class=tag><a href=/tags/cpp>cpp</a></span><span class=tag><a href=/tags/bindings>bindings</a></span><span class=tag><a href=/tags/packaging>packaging</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>964 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2023-11-10 18:50 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22Writing%20R%20Packages%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&amp;url=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22Writing%20R%20Packages%22%20seems%20interesting...&amp;body=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f&amp;title=%22Writing%20R%20Packages%22%20seems%20interesting...&amp;summary=%22Writing%20R%20Packages%22%20seems%20interesting...&amp;source=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f&amp;resubmit=true&amp;title=%22Writing%20R%20Packages%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22Writing%20R%20Packages%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2fwriting-r-packages%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://rgoswami.me/posts/types-fortran-python-opaque/><span class=button__icon>‚Üê</span>
<span class=button__text>Types from Fortran to Python via Opaque Pointers</span>
</a></span><span class="button next"><a href=https://rgoswami.me/posts/managing-cloud-based-calibre/><span class=button__text>Managing cloud based calibre libraries</span>
<span class=button__icon>‚Üí</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><script src=https://utteranc.es/client.js repo=haozeke/haozeke.github.io issue-term=pathname theme=photon-dark label="Utterance üí¨" crossorigin=anonymous async></script></div></main><footer class=footer><p>&copy; 2024
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-109503488-16","auto"),ga("send","pageview")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script><script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script><script src=/js/codefold.min.f0790269b87613b3bcff64022840fe1991eee3ea384e874c78a24022c9936bd888a3c14a05a10955881eebb1558e4fcf37576dac120cd0bf4ebaf7aca27b35b1.js></script><script src=/js/copyClipboard.min.1c92539aea398296101add0e80508ad94cb59fb37f946f06ec9ca1c7558a961b8de0c5595a921aed70aa91eb94d24db35e5a01243bc625f8b1814b17928f478b.js></script></body></html>