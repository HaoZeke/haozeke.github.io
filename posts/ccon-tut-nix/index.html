<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="Brief introduction to a nix based project workflow.
 Background For CarpentryCon@Home 2020, along with Amrita Goswami, I am to prepare and deliver a workshop on &amp;ldquo;Reproducible Environments with the Nix Packaging System.&amp;rdquo; In particular, as a community of practice lesson, the focus is not on packaging (as is typical of most Nix tutorials) nor on the Nix expression language itself, but instead on the use of Nix as a replacement for virtual environments using mkShell."><meta name=keywords content=",tools,nix,workflow,python"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/ccon-tut-nix/><title>A Tutorial Introduction to Nix :: Rohit Goswami — Reflections</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.b6dbce0fdf6c61563a0c2226e857d5dadd8e5afa2c4f73ec9ea55abd831f9a72.css><meta itemprop=name content="A Tutorial Introduction to Nix"><meta itemprop=description content="Brief introduction to a nix based project workflow.
 Background For CarpentryCon@Home 2020, along with Amrita Goswami, I am to prepare and deliver a workshop on &ldquo;Reproducible Environments with the Nix Packaging System.&rdquo; In particular, as a community of practice lesson, the focus is not on packaging (as is typical of most Nix tutorials) nor on the Nix expression language itself, but instead on the use of Nix as a replacement for virtual environments using mkShell."><meta itemprop=datePublished content="2020-08-18T16:18:00+00:00"><meta itemprop=dateModified content="2020-08-18T16:18:00+00:00"><meta itemprop=wordCount content="2022"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="tools,nix,workflow,python,"><meta property="og:title" content="A Tutorial Introduction to Nix"><meta property="og:description" content="Brief introduction to a nix based project workflow.
 Background For CarpentryCon@Home 2020, along with Amrita Goswami, I am to prepare and deliver a workshop on &ldquo;Reproducible Environments with the Nix Packaging System.&rdquo; In particular, as a community of practice lesson, the focus is not on packaging (as is typical of most Nix tutorials) nor on the Nix expression language itself, but instead on the use of Nix as a replacement for virtual environments using mkShell."><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/ccon-tut-nix/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-18T16:18:00+00:00"><meta property="article:modified_time" content="2020-08-18T16:18:00+00:00"><meta property="og:site_name" content="Rohit Goswami"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="A Tutorial Introduction to Nix"><meta name=twitter:description content="Brief introduction to a nix based project workflow.
 Background For CarpentryCon@Home 2020, along with Amrita Goswami, I am to prepare and deliver a workshop on &ldquo;Reproducible Environments with the Nix Packaging System.&rdquo; In particular, as a community of practice lesson, the focus is not on packaging (as is typical of most Nix tutorials) nor on the Nix expression language itself, but instead on the use of Nix as a replacement for virtual environments using mkShell."><meta property="article:section" content="programming"><meta property="article:published_time" content="2020-08-18 16:18:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://rgoswami.me/about>About</a></li><li><a href=https://rgoswami.me/posts>Blog</a></li></ul><ul class=menu__inner><li><a href=https://rgoswami.me/categories>Categories</a></li><li><a href=https://rgoswami.me/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=https://rgoswami.me/js/mathjax-config.js></script><script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#materials>Materials</a></li><li><a href=#ten-seconds-into-nix>Ten seconds into Nix</a></li><li><a href=#setup>Setup</a></li><li><a href=#basic-helpers>Basic Helpers</a><ul><li><a href=#exercise-1>Exercise 1</a></li></ul></li><li><a href=#more-dependable-dependencies>More Dependable Dependencies</a><ul><li><a href=#standard-channels>Standard Channels</a></li><li><a href=#pinning-dependencies>Pinning Dependencies</a></li></ul></li><li><a href=#project-setup>Project Setup</a><ul><li><a href=#lorri-and-direnv>lorri and direnv</a></li><li><a href=#pinning-with-niv>Pinning with niv</a></li></ul></li><li><a href=#purity-and-environments>Purity and Environments</a></li><li><a href=#mkshell>mkShell</a><ul><li><a href=#shell-hooks>Shell Hooks</a></li></ul></li><li><a href=#overriding-global-packages>Overriding Global Packages</a></li><li><a href=#python-dependencies>Python Dependencies</a><ul><li><a href=#generic-environments>Generic Environments</a></li><li><a href=#project-local-pip>Project Local Pip</a></li></ul></li><li><a href=#non-standard-python>Non-Standard Python</a><ul><li><a href=#building-packages>Building Packages</a></li><li><a href=#setting-versions>Setting Versions</a></li></ul></li><li><a href=#build-helpers>Build Helpers</a></li><li><a href=#supplementary-reading-material>Supplementary Reading Material</a><ul><li><a href=#core-content>Core Content</a></li><li><a href=#learning-paths>Learning Paths</a></li><li><a href=#personal-correspondence>Personal Correspondence</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#references>References</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>10 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2020-08-18 16:18 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/ccon-tut-nix/>A Tutorial Introduction to Nix</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=https://rgoswami.me/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#materials>Materials</a></li><li><a href=#ten-seconds-into-nix>Ten seconds into Nix</a></li><li><a href=#setup>Setup</a></li><li><a href=#basic-helpers>Basic Helpers</a><ul><li><a href=#exercise-1>Exercise 1</a></li></ul></li><li><a href=#more-dependable-dependencies>More Dependable Dependencies</a><ul><li><a href=#standard-channels>Standard Channels</a></li><li><a href=#pinning-dependencies>Pinning Dependencies</a></li></ul></li><li><a href=#project-setup>Project Setup</a><ul><li><a href=#lorri-and-direnv>lorri and direnv</a></li><li><a href=#pinning-with-niv>Pinning with niv</a></li></ul></li><li><a href=#purity-and-environments>Purity and Environments</a></li><li><a href=#mkshell>mkShell</a><ul><li><a href=#shell-hooks>Shell Hooks</a></li></ul></li><li><a href=#overriding-global-packages>Overriding Global Packages</a></li><li><a href=#python-dependencies>Python Dependencies</a><ul><li><a href=#generic-environments>Generic Environments</a></li><li><a href=#project-local-pip>Project Local Pip</a></li></ul></li><li><a href=#non-standard-python>Non-Standard Python</a><ul><li><a href=#building-packages>Building Packages</a></li><li><a href=#setting-versions>Setting Versions</a></li></ul></li><li><a href=#build-helpers>Build Helpers</a></li><li><a href=#supplementary-reading-material>Supplementary Reading Material</a><ul><li><a href=#core-content>Core Content</a></li><li><a href=#learning-paths>Learning Paths</a></li><li><a href=#personal-correspondence>Personal Correspondence</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#references>References</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p>Brief introduction to a nix based project workflow.</p></blockquote><h2 id=background>Background</h2><p>For <a href=https://2020.carpentrycon.org/>CarpentryCon@Home 2020</a>, along with
<a href="https://scholar.google.com/citations?user=mviv92EAAAAJ&hl=en">Amrita
Goswami</a>,
I am to prepare and deliver a workshop on &ldquo;<a href=https://2020.carpentrycon.org/schedule/#session-10>Reproducible Environments
with the Nix Packaging
System</a>.&rdquo; In
particular, as a community of practice lesson, the focus is not on
packaging (as is typical of most Nix tutorials) nor on the Nix
expression language itself, but instead on the use of Nix as a
replacement for virtual environments using <code>mkShell</code>.</p><h2 id=materials>Materials</h2><p>This is a Carpentries style single page lesson on setting up and working
with Nix for reproducible environments. It was concieved to be a
complimentary resource to the content of <a href=https://github.com/HaoZeke/CarpentryCon2020%5FNix>this
repository</a>, namely:</p><ul><li><a href=https://github.com/HaoZeke/CarpentryCon2020%5FNix/blob/master/slides/nixPython/nixPython.pdf>Slides on Python packages with
Nix</a></li><li><a href=https://rgoswami.me/posts/nix-r-devtools/>Nix with R and devtools</a></li><li><a href=https://rgoswami.me/posts/rethinking-r-nix/>Statistical Rethinking and
Nix</a></li><li><a href=https://pad.carpentries.org/cchome-nix-packaging>An Etherpad</a></li><li><a href="https://www.youtube.com/watch?v=np6TPzME0aA">Session recording</a></li></ul><h2 id=ten-seconds-into-nix>Ten seconds into Nix</h2><p>A few words to keep in mind, in no particular order.</p><ul><li>Nix is based of good academic principles by Dolstra, de Jonge, and
Visser (2004) and Dolstra, Löh, and Pierron (2010)<ul><li>It has been used in large scientific projects for
reproducibility (e.g. <a href=https://dseams.info>d-SEAMS</a> of Goswami,
Goswami, and Singh (2020))</li></ul></li><li>The Nix expression language is a <strong>domain specific language</strong><ul><li>Turing completeness is not a goal or a requirement</li></ul></li><li>Can leverage binary caches<ul><li>Not <span class=underline>always</span> true, only when
installed in <code>/nix</code></li></ul></li></ul><h2 id=setup>Setup</h2><p>For this particular tutorial, we will assume the standard Nix
installation proceedure, that is, one where the installer has root
access to create the initial <code>/nix</code> directory and set up the build
users<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. This follows directly from the <a href=https://nixos.org/nix/manual/#chap-installation>Nix
Manual</a>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># You need root permissions for this!!!</span>
sh &lt;<span class=o>(</span>curl -L https://nixos.org/nix/install<span class=o>)</span> --daemon
</code></pre></div><p>At this point we will also install the canonnical first package, the
<code>hello</code> package, which simply outputs a friendly greeting.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>nix-env -i hello
</code></pre></div><p>Note that the basic package search operation is <code>nix search</code> and it
gives outputs which look like:</p><figure><img src=/ox-hugo/nixSearchSetup.png alt="Figure 1: The nix search emacs output"><figcaption><p>Figure 1: The <code>nix search emacs</code> output</p></figcaption></figure><p>Though this is not bad by any standard, we will try to get a more
interactive management tool.</p><h2 id=basic-helpers>Basic Helpers</h2><p>The first few things to obtain are:</p><dl><dt><a href=https://github.com/madjar/nox>nox</a></dt><dd>This is a better package management helper</dd><dt><a href=https://github.com/nmattia/niv>niv</a></dt><dd>For pinning dependencies as discussed later</dd><dt><a href=https://github.com/target/lorri>lorri</a></dt><dd>For working seamlessly with project environments</dd></dl><h3 id=exercise-1>Exercise 1</h3><blockquote><p>Try installing these and use <code>nox emacs</code> to test the output</p></blockquote><figure><img src=/ox-hugo/basicHelpers.png alt="Figure 2: The nox emacs output"><figcaption><p>Figure 2: The <code>nox emacs</code> output</p></figcaption></figure><h2 id=more-dependable-dependencies>More Dependable Dependencies</h2><h3 id=standard-channels>Standard Channels</h3><p>Nix works by searching a repository (local or online) of package
derivations. Indeed, we can pass <code>nix-env</code> any local fork of the main
<a href=https://github.com/NixOS/nixpkgs>nixpkgs repo</a> as well.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># don&#39;t run this, it is a large repo</span>
git clone https://github.com/NixOS/nixpkgs.git <span class=nv>$mynixdir</span>
<span class=c1># make changes..</span>
<span class=nv>$EDITOR</span> <span class=nv>$nixpkgs</span>/pkgs/applications/editors/emacs/default.nix
nix-env -i emacs -f <span class=nv>$nixpkgs</span>
</code></pre></div><ul><li>This might serve as a way to mass modify the <code>nixpkgs</code> in a pinch<ul><li>However, we will almost <strong>never</strong> use this in practice</li><li>The overlay approach is much better</li></ul></li><li>It is also useful if we need to build local derivations</li></ul><h3 id=pinning-dependencies>Pinning Dependencies</h3><p>Compared to globally tracking the branches of <code>nixpkgs</code> or even local
changes and forks, for project oriented workflows it is better to use
<code>niv</code> which we obtained previously. In a nutshell, <code>niv</code> will generate a
<code>json</code> file to keep track of dependencies and wraps it in a <code>nix</code> file
we can subsequently import and use.</p><h2 id=project-setup>Project Setup</h2><p>We are now in a position to start working with a project oriented
workflow.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># Make directories</span>
mkdir myFirstNix
<span class=nb>cd</span> myFirstNix
<span class=c1># Setup</span>
niv init
niv update nixpkgs -b nixpkgs-unstable
</code></pre></div><p>At this stage your project should have the following structure:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>tree myFirstNix
</code></pre></div><table><thead><tr><th>myFirstNix</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>└──</td><td>nix</td><td></td><td></td></tr><tr><td>├──</td><td>sources.json</td><td></td><td></td></tr><tr><td>└──</td><td>sources.nix</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>1</td><td>directory,</td><td>2</td><td>files</td></tr></tbody></table><p>We can now move on to the heart of this tutorial, the <code>nix-shell</code>. In a
nutshell, running <code>nix-shell</code> when there is a defined <code>shell.nix</code> will
spawn a virtual environment with the nix packages requested.</p><h3 id=lorri-and-direnv>lorri and direnv</h3><p>Though we haven&rsquo;t as yet generated a <code>shell.nix</code> we should point out
that writing one by hand will mean that we need to rebuild the
enviroment when we make changes using <code>nix-shell</code> every time. A more
elegant approach is to offload the rebuilding of the environment to
<code>lorri</code> which also has a neat <code>direnv</code> integrration. Let&rsquo;s try that out.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> myFirstNix
lorri init
</code></pre></div><table><thead><tr><th>Aug</th><th>18</th><th>15:24:06.524</th><th>INFO</th><th>wrote</th><th>file,</th><th>path:</th><th>./shell.nix</th></tr></thead><tbody><tr><td>Aug</td><td>18</td><td>15:24:06.524</td><td>INFO</td><td>wrote</td><td>file,</td><td>path:</td><td>./.envrc</td></tr><tr><td>Aug</td><td>18</td><td>15:24:06.524</td><td>INFO</td><td>done</td><td></td><td></td><td></td></tr></tbody></table><p>At this point we should now have:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>tree -a myFirstNix
</code></pre></div><table><thead><tr><th>myFirstNix</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>├──</td><td>.envrc</td><td></td><td></td></tr><tr><td>├──</td><td>nix</td><td></td><td></td></tr><tr><td>│  </td><td>├──</td><td>sources.json</td><td></td></tr><tr><td>│  </td><td>└──</td><td>sources.nix</td><td></td></tr><tr><td>└──</td><td>shell.nix</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>1</td><td>directory,</td><td>4</td><td>files</td></tr></tbody></table><p>We might want to take a quick look at what is being loaded into the
environment and the <code>shell.nix</code> at this point.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=n>pkgs</span> <span class=o>=</span> <span class=kn>import</span> <span class=sr>&lt;nixpkgs&gt;</span> <span class=p>{};</span>
<span class=k>in</span>
<span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>pkgs</span><span class=o>.</span><span class=n>hello</span>
  <span class=p>];</span>
<span class=p>}</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 1</span>:
<code>shell.nix</code></p></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>eval</span> <span class=s2>&#34;</span><span class=k>$(</span>lorri direnv<span class=k>)</span><span class=s2>&#34;</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 2</span>:
<code>.envrc</code></p></div><p>The <code>.envrc</code> output is not very useful at a glance, however when we cd
into the directory it is very verbose and explicit about what is being
set up.</p><figure><img src=/ox-hugo/prjSetup.png alt="Figure 3: Sample output of the evaluation"><figcaption><p>Figure 3: Sample output of the evaluation</p></figcaption></figure><p>Note that in order to set <code>lorri</code> up, we will need to set up a daemon.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>systemctl --user start lorri
direnv allow
</code></pre></div><h3 id=pinning-with-niv>Pinning with niv</h3><p>Note that inspite of having set up <code>niv</code>, we have not yet used the
sources defined therein. We will now fix this, by modifying <code>shell.nix</code>.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=n>sources</span> <span class=o>=</span> <span class=kn>import</span> <span class=sr>./nix/sources.nix</span><span class=p>;</span>
  <span class=n>pkgs</span> <span class=o>=</span> <span class=kn>import</span> <span class=n>sources</span><span class=o>.</span><span class=n>nixpkgs</span> <span class=p>{</span> <span class=p>};</span>
  <span class=k>inherit</span> <span class=p>(</span><span class=n>pkgs</span><span class=o>.</span><span class=n>lib</span><span class=p>)</span> <span class=n>optional</span> <span class=n>optionals</span><span class=p>;</span>
<span class=k>in</span>
<span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=p>[</span>
    <span class=n>pkgs</span><span class=o>.</span><span class=n>hello</span>
  <span class=p>];</span>
<span class=p>}</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 3</span>:
<code>shell.nix</code> with <code>niv</code></p></div><h2 id=purity-and-environments>Purity and Environments</h2><p>There are a couple of things to note about this setup.</p><ul><li>The default shell is <code>bash</code></li><li>On occasion, depending on your Dotfiles you might have paths
overriden in an annoying way</li></ul><p>One workaround is to use nix shell with an argument:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>nix-shell --run <span class=s2>&#34;bash&#34;</span>
</code></pre></div><ul><li>We can also pass <code>--pure</code> to the function, but at the cost of having
to define many more dependencies for our shell</li></ul><h2 id=mkshell>mkShell</h2><p>The <code>mkShell</code> function is the focus of our tutorial, and we will mostly
work around passing in different environments and hooks. Let us start by
defining a hook.</p><h3 id=shell-hooks>Shell Hooks</h3><p>Often, we will want to set an environment variable in our shell in
advance. We should not use <code>direnv</code> for this, and instead we will focus
on the <code>shellHook</code> option. Syntactically, we note that this is of the
form:</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=n>hook</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span><span class=s1>  export myvar=&#34;Test&#34;
</span><span class=s1>  &#39;&#39;</span>
<span class=k>in</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>shellHook</span> <span class=o>=</span> <span class=n>hook</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>Often we will describe variables in the let section in favor of
cluttering the actual function call itself.</p><h2 id=overriding-global-packages>Overriding Global Packages</h2><p>For overriding global packages, it is best to leverage the <code>config.nix</code>
(which is commonly in <code>$HOME/.config/nixpkgs/config.nix</code>) file instead
of the current environment, though it could be managed in a per-project
setup as well. Consider the case where we need to disable tests for a
particular packages, say <code>libuv</code>.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=p>{</span>
  <span class=n>packageOverrides</span> <span class=o>=</span> <span class=n>pkgs</span><span class=p>:</span>
    <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>{</span>
      <span class=n>libuv</span> <span class=o>=</span> <span class=n>libuv</span><span class=o>.</span><span class=n>overrideAttrs</span> <span class=p>(</span><span class=n>oldAttrs</span><span class=p>:</span> <span class=p>{</span>
        <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
        <span class=n>doInstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
      <span class=p>});</span>
    <span class=p>};</span>
<span class=p>}</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 4</span>: A sample
<code>config.nix</code> file</p></div><h2 id=python-dependencies>Python Dependencies</h2><p>As R dependency management has been covered <a href=/posts/nix-r-devtools/>in an earlier post</a>, we will focus on the management of
<code>python</code> environments.</p><h3 id=generic-environments>Generic Environments</h3><p>We can define existing packages as follows (and can check for existence
with <code>nox</code>) using the <code>let..in</code> syntax.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=c1># Niv</span>
  <span class=n>sources</span> <span class=o>=</span> <span class=kn>import</span> <span class=sr>./nix/sources.nix</span><span class=p>;</span>
  <span class=n>pkgs</span> <span class=o>=</span> <span class=kn>import</span> <span class=n>sources</span><span class=o>.</span><span class=n>nixpkgs</span> <span class=p>{</span> <span class=p>};</span>
  <span class=k>inherit</span> <span class=p>(</span><span class=n>pkgs</span><span class=o>.</span><span class=n>lib</span><span class=p>)</span> <span class=n>optional</span> <span class=n>optionals</span><span class=p>;</span>
  <span class=c1># Python</span>
  <span class=n>pythonEnv</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>python38</span><span class=o>.</span><span class=n>withPackages</span> <span class=p>(</span><span class=n>ps</span><span class=p>:</span> <span class=k>with</span> <span class=n>ps</span><span class=p>;[</span>
    <span class=n>numpy</span>
    <span class=n>toolz</span>
  <span class=p>]);</span>
<span class=k>in</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span>
    <span class=n>pythonEnv</span>

    <span class=n>black</span>
    <span class=n>mypy</span>

    <span class=n>libffi</span>
    <span class=n>openssl</span>
  <span class=p>];</span>
<span class=p>}</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 5</span>: Shell with basic
<code>python</code> environment</p></div><h3 id=project-local-pip>Project Local Pip</h3><p>We can leverage a trick from
<a href=https://churchman.nl/2019/01/22/using-nix-to-create-python-virtual-environments/>here</a>
to set a local directory for <code>pip</code> installations, which boils down to
some path hacking.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=c1># Niv</span>
  <span class=n>sources</span> <span class=o>=</span> <span class=kn>import</span> <span class=sr>./nix/sources.nix</span><span class=p>;</span>
  <span class=n>pkgs</span> <span class=o>=</span> <span class=kn>import</span> <span class=n>sources</span><span class=o>.</span><span class=n>nixpkgs</span> <span class=p>{</span> <span class=p>};</span>
  <span class=k>inherit</span> <span class=p>(</span><span class=n>pkgs</span><span class=o>.</span><span class=n>lib</span><span class=p>)</span> <span class=n>optional</span> <span class=n>optionals</span><span class=p>;</span>
  <span class=c1># Python</span>
  <span class=n>pythonEnv</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>python38</span><span class=o>.</span><span class=n>withPackages</span> <span class=p>(</span><span class=n>ps</span><span class=p>:</span> <span class=k>with</span> <span class=n>ps</span><span class=p>;[</span>
    <span class=n>numpy</span>
    <span class=n>toolz</span>
  <span class=p>]);</span>
  <span class=n>hook</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span><span class=s1>     export PIP_PREFIX=&#34;$(pwd)/_build/pip_packages&#34;
</span><span class=s1>     export PYTHONPATH=&#34;$(pwd)/_build/pip_packages/lib/python3.8/site-packages:$PYTHONPATH&#34;
</span><span class=s1>     export PATH=&#34;$PIP_PREFIX/bin:$PATH&#34;
</span><span class=s1>     unset SOURCE_DATE_EPOCH
</span><span class=s1>  &#39;&#39;</span><span class=p>;</span>
<span class=k>in</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span>
    <span class=n>pythonEnv</span>

    <span class=n>black</span>
    <span class=n>mypy</span>

    <span class=n>libffi</span>
    <span class=n>openssl</span>
  <span class=p>];</span>
  <span class=n>shellHook</span> <span class=o>=</span> <span class=n>hook</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p><strong>Note that</strong> this is discouraged as we will lose the caching
capabilities of nix.</p><h2 id=non-standard-python>Non-Standard Python</h2><p>For more control over the environment, we can define it in more detail
with some overlays.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=k>let</span>
  <span class=n>python</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>python38</span><span class=o>.</span><span class=n>override</span> <span class=p>{</span>
    <span class=n>packageOverrides</span> <span class=o>=</span> <span class=n>self</span><span class=p>:</span> <span class=n>super</span><span class=p>:</span> <span class=p>{</span>
      <span class=n>pytest</span> <span class=o>=</span> <span class=n>super</span><span class=o>.</span><span class=n>pytest</span><span class=o>.</span><span class=n>overridePythonAttrs</span> <span class=p>(</span><span class=n>old</span><span class=p>:</span> <span class=k>rec</span> <span class=p>{</span>
        <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
        <span class=n>doInstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
      <span class=p>});</span>
    <span class=p>};</span>
  <span class=p>};</span>
  <span class=n>myPy</span> <span class=o>=</span> <span class=n>python</span><span class=o>.</span><span class=n>withPackages</span>
    <span class=p>(</span><span class=n>p</span><span class=p>:</span> <span class=k>with</span> <span class=n>p</span><span class=p>;</span> <span class=p>[</span> <span class=n>numpy</span> <span class=n>pip</span> <span class=n>pytest</span> <span class=p>]);</span>
<span class=k>in</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span>
    <span class=n>myPy</span>
  <span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>We have used both overriden packages and standard packages in the above
formulation.</p><h3 id=building-packages>Building Packages</h3><p>For cases where we are certain that no existing package is present (use
<code>nox</code>) we can also build them. Take <code>f90wrap</code> as an example, and we will
use the Github version, rather than the PyPi version (the difference is
in the source fetch function).</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=n>f90wrap</span> <span class=err>=</span> <span class=n>self</span><span class=o>.</span><span class=n>buildPythonPackage</span> <span class=k>rec</span> <span class=p>{</span>
  <span class=n>pname</span> <span class=o>=</span> <span class=s2>&#34;f90wrap&#34;</span><span class=p>;</span>
  <span class=n>version</span> <span class=o>=</span> <span class=s2>&#34;0.2.3&#34;</span><span class=p>;</span>
  <span class=n>src</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>fetchFromGitHub</span> <span class=p>{</span>
    <span class=n>owner</span> <span class=o>=</span> <span class=s2>&#34;jameskermode&#34;</span><span class=p>;</span>
    <span class=n>repo</span> <span class=o>=</span> <span class=s2>&#34;f90wrap&#34;</span><span class=p>;</span>
    <span class=n>rev</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span><span class=p>;</span>
    <span class=n>sha256</span> <span class=o>=</span> <span class=s2>&#34;0d06nal4xzg8vv6sjdbmg2n88a8h8df5ajam72445mhzk08yin23&#34;</span><span class=p>;</span>
  <span class=p>};</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span> <span class=n>gfortran</span> <span class=n>stdenv</span> <span class=p>];</span>
  <span class=n>propagatedBuildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>self</span><span class=p>;</span> <span class=p>[</span>
    <span class=n>setuptools</span>
    <span class=n>setuptools-git</span>
    <span class=n>wheel</span>
    <span class=n>numpy</span>
  <span class=p>];</span>
  <span class=n>preConfigure</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span><span class=s1>    export F90=</span><span class=si>${</span><span class=n>pkgs</span><span class=o>.</span><span class=n>gfortran</span><span class=si>}</span><span class=s1>/bin/gfortran
</span><span class=s1>  &#39;&#39;</span><span class=p>;</span>
  <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
  <span class=n>doIstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
<span class=p>};</span>
</code></pre></div><p>This is quite involved, <span class=underline>discuss</span>.</p><h3 id=setting-versions>Setting Versions</h3><p>We can finally generalize our <code>shell.nix</code> to default to <code>python 3.8</code> but
also take a command through <code>--argstr</code>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>nix-shell --argstr pythonVersion <span class=m>36</span> --run <span class=s2>&#34;bash&#34;</span>
</code></pre></div><p>Where we need to simply define the option at the top of the file, with a
default.</p><div class=highlight><pre class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>pythonVersion</span> <span class=o>?</span> <span class=s2>&#34;38&#34;</span> <span class=p>}:</span>
<span class=c1># Define</span>
<span class=k>let</span>
  <span class=n>sources</span> <span class=o>=</span> <span class=kn>import</span> <span class=sr>./nix/sources.nix</span><span class=p>;</span>
  <span class=n>pkgs</span> <span class=o>=</span> <span class=kn>import</span> <span class=n>sources</span><span class=o>.</span><span class=n>nixpkgs</span> <span class=p>{</span> <span class=p>};</span>
  <span class=k>inherit</span> <span class=p>(</span><span class=n>pkgs</span><span class=o>.</span><span class=n>lib</span><span class=p>)</span> <span class=n>optional</span> <span class=n>optionals</span><span class=p>;</span>
  <span class=n>hook</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span><span class=s1>    # Python Stuff
</span><span class=s1>     export PIP_PREFIX=&#34;$(pwd)/_build/pip_packages&#34;
</span><span class=s1>     export PYTHONPATH=&#34;$(pwd)/_build/pip_packages/lib/python3.8/site-packages:$PYTHONPATH&#34;
</span><span class=s1>     export PATH=&#34;$PIP_PREFIX/bin:$PATH&#34;
</span><span class=s1>     unset SOURCE_DATE_EPOCH
</span><span class=s1>  &#39;&#39;</span><span class=p>;</span>
  <span class=c1># Apparently pip needs 1980 or above</span>
  <span class=c1># https://github.com/ento/elm-doc/blob/master/shell.nix</span>
  <span class=n>python</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=s2>&#34;python</span><span class=si>${</span><span class=n>pythonVersion</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>override</span> <span class=p>{</span>
    <span class=n>packageOverrides</span> <span class=o>=</span> <span class=n>self</span><span class=p>:</span> <span class=n>super</span><span class=p>:</span> <span class=p>{</span>
      <span class=n>pytest</span> <span class=o>=</span> <span class=n>super</span><span class=o>.</span><span class=n>pytest</span><span class=o>.</span><span class=n>overridePythonAttrs</span> <span class=p>(</span><span class=n>old</span><span class=p>:</span> <span class=k>rec</span> <span class=p>{</span>
        <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
        <span class=n>doInstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
      <span class=p>});</span>
      <span class=n>ase</span> <span class=o>=</span> <span class=n>super</span><span class=o>.</span><span class=n>ase</span><span class=o>.</span><span class=n>overridePythonAttrs</span> <span class=p>(</span><span class=n>old</span><span class=p>:</span> <span class=k>rec</span> <span class=p>{</span>
        <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
        <span class=n>doInstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
      <span class=p>});</span>
      <span class=n>f90wrap</span> <span class=o>=</span> <span class=n>self</span><span class=o>.</span><span class=n>buildPythonPackage</span> <span class=k>rec</span> <span class=p>{</span>
        <span class=n>pname</span> <span class=o>=</span> <span class=s2>&#34;f90wrap&#34;</span><span class=p>;</span>
        <span class=n>version</span> <span class=o>=</span> <span class=s2>&#34;0.2.3&#34;</span><span class=p>;</span>
        <span class=n>src</span> <span class=o>=</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>fetchFromGitHub</span> <span class=p>{</span>
          <span class=n>owner</span> <span class=o>=</span> <span class=s2>&#34;jameskermode&#34;</span><span class=p>;</span>
          <span class=n>repo</span> <span class=o>=</span> <span class=s2>&#34;f90wrap&#34;</span><span class=p>;</span>
          <span class=n>rev</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span><span class=p>;</span>
          <span class=n>sha256</span> <span class=o>=</span> <span class=s2>&#34;0d06nal4xzg8vv6sjdbmg2n88a8h8df5ajam72445mhzk08yin23&#34;</span><span class=p>;</span>
        <span class=p>};</span>
        <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span> <span class=n>gfortran</span> <span class=n>stdenv</span> <span class=p>];</span>
        <span class=n>propagatedBuildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>self</span><span class=p>;</span> <span class=p>[</span>
          <span class=n>setuptools</span>
          <span class=n>setuptools-git</span>
          <span class=n>wheel</span>
          <span class=n>numpy</span>
        <span class=p>];</span>
        <span class=n>preConfigure</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span><span class=s1>          export F90=</span><span class=si>${</span><span class=n>pkgs</span><span class=o>.</span><span class=n>gfortran</span><span class=si>}</span><span class=s1>/bin/gfortran
</span><span class=s1>        &#39;&#39;</span><span class=p>;</span>
        <span class=n>doCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
        <span class=n>doInstallCheck</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
      <span class=p>};</span>
    <span class=p>};</span>
  <span class=p>};</span>
  <span class=n>myPy</span> <span class=o>=</span> <span class=n>python</span><span class=o>.</span><span class=n>withPackages</span>
    <span class=p>(</span><span class=n>p</span><span class=p>:</span> <span class=k>with</span> <span class=n>p</span><span class=p>;</span> <span class=p>[</span> <span class=n>ase</span> <span class=n>ipython</span> <span class=n>ipykernel</span> <span class=n>scipy</span> <span class=n>numpy</span> <span class=n>f90wrap</span> <span class=n>pip</span> <span class=p>]);</span>
<span class=k>in</span> <span class=n>pkgs</span><span class=o>.</span><span class=n>mkShell</span> <span class=p>{</span>
  <span class=n>buildInputs</span> <span class=o>=</span> <span class=k>with</span> <span class=n>pkgs</span><span class=p>;</span> <span class=p>[</span>
    <span class=c1># Required for the shell</span>
    <span class=n>zsh</span>
    <span class=n>perl</span>
    <span class=n>git</span>
    <span class=n>direnv</span>
    <span class=n>fzf</span>
    <span class=n>ag</span>
    <span class=n>fd</span>

    <span class=c1># Building thigns</span>
    <span class=n>gcc9</span>
    <span class=n>gfortran</span>
    <span class=n>openblas</span>

    <span class=n>myPy</span>
    <span class=c1># https://github.com/sveitser/i-am-emotion/blob/294971493a8822940a153ba1bf211bad3ae396e6/gpt2/shell.nix</span>
  <span class=p>];</span>
  <span class=n>shellHook</span> <span class=o>=</span> <span class=n>hook</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><div class=src-block-caption><p><span class=src-block-number>Code Snippet 6</span>: Full
<code>shell.nix</code></p></div><p>This is enough to cover almost all use-cases for <code>python</code> environments.</p><h2 id=build-helpers>Build Helpers</h2><p>Note that we can speed up some aspects of fetch with the prefetch
commands:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>nix-prefetch-git <span class=nv>$giturl</span>
nix-prefetch-url <span class=nv>$url</span>
</code></pre></div><p>In practice, some trial and error is easier.</p><h2 id=supplementary-reading-material>Supplementary Reading Material</h2><p>Though these are in no means exhaustive, they may offer a slightly more
advanced or different focus than the material covered here.</p><h3 id=core-content>Core Content</h3><ul><li>Manuals<ul><li><a href=https://nixos.org/nix/manual/>Nix</a> and Nixpkgs</li></ul></li><li><a href=https://nixos.wiki/>Nix Wiki</a><ul><li><a href="https://nixos.wiki/index.php?title=Cheatsheet&useskin=vector">Nix
Cheatsheet</a></li></ul></li><li><a href=https://github.com/NixOS/nixpkgs/blob/master/doc/languages-frameworks/>Language
Sections</a></li></ul><h3 id=learning-paths>Learning Paths</h3><ul><li><a href=https://nixos.org/nixos/nix-pills/>Nix pills</a></li><li><a href=https://nixos.org/learn.html>Official tutorials</a></li><li><a href=https://nix.dev/>Nix dev</a> has some nice opinionated tips</li></ul><h3 id=personal-correspondence>Personal Correspondence</h3><p>Tyson Whitehead from Compute Canada was kind enough to bring the
folllowing additional training materials:</p><ul><li>A wiki pertaining to usage of Nix on in <a href=https://git.computecanada.ca/nix/training/-/tree/ccwiki>an HPC
setting</a></li><li>SWC style workshop materials from <a href=https://git.computecanada.ca/nix/training/-/tree/20180618-tecc>TECC
2018</a></li><li><a href=https://git.computecanada.ca/nix/training/-/tree/20180115-sharcnet>SHARCNET live presentation
materials</a>
from 2018</li></ul><h2 id=conclusions>Conclusions</h2><p>The standard dive into Nix is based on building derivations and playing
with language, which is in no means a bad one, just too long for the
time allocated. The best way to get into Nix is to start using it for
everything.</p><h2 id=references>References</h2><div id=refs class="references csl-bib-body hanging-indent"><div></div><div id=ref-dolstraNixSafePolicyFree2004 class=csl-entry><div></div><p>Dolstra, Eelco, Merijn de Jonge, and Eelco Visser. 2004. &ldquo;Nix: A Safe
and Policy-Free System for Software Deployment,&rdquo; 15.</p></div><div id=ref-dolstraNixOSPurelyFunctional2010 class=csl-entry><div></div><p>Dolstra, Eelco, Andres Löh, and Nicolas Pierron. 2010. &ldquo;NixOS: A Purely
Functional Linux Distribution.&rdquo; <em>Journal of Functional Programming</em> 20
(5-6): 577&ndash;615. <a href=https://doi.org/dfrgtj>https://doi.org/dfrgtj</a>.</p></div><div id=ref-goswamiDSEAMSDeferredStructural2020 class=csl-entry><div></div><p>Goswami, Rohit, Amrita Goswami, and Jayant K. Singh. 2020. &ldquo;D-SEAMS:
Deferred Structural Elucidation Analysis for Molecular Simulations.&rdquo;
<em>Journal of Chemical Information and Modeling</em> 60 (4): 2169&ndash;77.
<a href=https://doi.org/10.1021/acs.jcim.0c00031>https://doi.org/10.1021/acs.jcim.0c00031</a>.</p></div></div><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>For reasons pertaining to latency and ease-of-use, we will
assume the multi-user installation&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://rgoswami.me/tags/tools>tools</a></span><span class=tag><a href=https://rgoswami.me/tags/nix>nix</a></span><span class=tag><a href=https://rgoswami.me/tags/workflow>workflow</a></span><span class=tag><a href=https://rgoswami.me/tags/python>python</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>2022 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2020-08-18 16:18 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&url=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20interesting...&body=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f&title=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20interesting...&summary=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20interesting...&source=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f&resubmit=true&title=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22A%20Tutorial%20Introduction%20to%20Nix%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2fccon-tut-nix%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://rgoswami.me/posts/nix-shell-node/><span class=button__icon>←</span>
<span class=button__text>Nix Shells for Node Projects</span></a></span>
<span class="button next"><a href=https://rgoswami.me/posts/hpc-dots-lmod/><span class=button__text>HPC Dotfiles and LMod</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><div id=remarkbox-div><noscript><iframe id=remarkbox-iframe src="https://my.remarkbox.com/embed?nojs=true" style=height:600px;width:100%;border:none!important tabindex=0></iframe></noscript></div><script src=https://my.remarkbox.com/static/js/iframe-resizer/iframeResizer.min.js></script><script>var rb_owner_key="8e660759-e7e6-11ea-9711-040140774501",thread_uri=window.location.href,thread_title=window.document.title,thread_fragment=window.location.hash,rb_src="https://my.remarkbox.com/embed?rb_owner_key="+rb_owner_key+"&thread_title="+encodeURI(thread_title)+"&thread_uri="+encodeURIComponent(thread_uri)+thread_fragment;function create_remarkbox_iframe(){var a=document.createElement("iframe");a.setAttribute("id","remarkbox-iframe"),a.setAttribute("scrolling","no"),a.setAttribute("src",rb_src),a.setAttribute("frameborder","0"),a.setAttribute("tabindex","0"),a.setAttribute("title","Remarkbox"),a.style.width="100%",document.getElementById("remarkbox-div").appendChild(a)}create_remarkbox_iframe(),iFrameResize({checkOrigin:["https://my.remarkbox.com"],inPageLinks:!0,initCallback:function(a){a.iFrameResizer.moveToAnchor(thread_fragment)}},document.getElementById("remarkbox-iframe"))</script></div></main><footer class=footer><p>&copy; 2021
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=https://rgoswami.me/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-109503488-16','auto'),ga('send','pageview')</script><script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script><script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script><script src=/js/codefold.min.4a43062cb83308b55227adf937c91be79ff6d95df8bb821dfd71805ce54629ff8cffed3ae81d70fdee5f324fa0f39c5280ae785f165801885db074551a993a21.js></script></body></html>