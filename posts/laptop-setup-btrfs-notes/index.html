<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="Thoughts on laptop configurations for ArchLinux in 2023, with btrfs and sway
Warning
This post is a little less complete than most, it has been dated to roughly the correct time chronologically.
Background I split this post from the previous one, to make each more self contained. Since the installation media has more features one might perhaps use gparted for resizing disks, use the GUI for managing networks, etc. Personally I generally allocate a chunk from whatever other OS is present in gparted, and format it as unformatted."><meta name=keywords content="personal,ramblings,setup,archlinux"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/laptop-setup-btrfs-notes/><meta name=generator content="Wooframework"><title>Laptop setup notes btrfs subvolumes :: Rohit Goswami — Reflections
</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.054e30538b054b321af6575a7659f551cec63e1cef6bbd674acccadf856d3aff.css><meta itemprop=name content="Laptop setup notes btrfs subvolumes"><meta itemprop=description content="Thoughts on laptop configurations for ArchLinux in 2023, with btrfs and sway
Warning
This post is a little less complete than most, it has been dated to roughly the correct time chronologically.
Background I split this post from the previous one, to make each more self contained. Since the installation media has more features one might perhaps use gparted for resizing disks, use the GUI for managing networks, etc. Personally I generally allocate a chunk from whatever other OS is present in gparted, and format it as unformatted."><meta itemprop=datePublished content="2023-05-01T15:22:00+00:00"><meta itemprop=dateModified content="2023-05-01T15:22:00+00:00"><meta itemprop=wordCount content="895"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="ramblings,setup,archlinux,"><meta property="og:title" content="Laptop setup notes btrfs subvolumes"><meta property="og:description" content="Thoughts on laptop configurations for ArchLinux in 2023, with btrfs and sway
Warning
This post is a little less complete than most, it has been dated to roughly the correct time chronologically.
Background I split this post from the previous one, to make each more self contained. Since the installation media has more features one might perhaps use gparted for resizing disks, use the GUI for managing networks, etc. Personally I generally allocate a chunk from whatever other OS is present in gparted, and format it as unformatted."><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/laptop-setup-btrfs-notes/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-01T15:22:00+00:00"><meta property="article:modified_time" content="2023-05-01T15:22:00+00:00"><meta property="og:see_also" content="https://rgoswami.me/posts/customizing-archlinux-im/"><meta property="og:see_also" content="https://rgoswami.me/posts/revisiting-wayland-2021-archlinux/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="Laptop setup notes btrfs subvolumes"><meta name=twitter:description content="Thoughts on laptop configurations for ArchLinux in 2023, with btrfs and sway
Warning
This post is a little less complete than most, it has been dated to roughly the correct time chronologically.
Background I split this post from the previous one, to make each more self contained. Since the installation media has more features one might perhaps use gparted for resizing disks, use the GUI for managing networks, etc. Personally I generally allocate a chunk from whatever other OS is present in gparted, and format it as unformatted."><meta property="article:section" content="notes"><meta property="article:published_time" content="2023-05-01 15:22:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li><li><a href=/series>Series</a></li></ul><ul class=menu__inner><li><a href=/categories>Categories</a></li><li><a href=/snippets>Snippets</a></li><li><a href=/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=/js/mathjax-config.js></script><script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#input-variants-with-sway>Input variants with <code>sway</code></a></li><li><a href=#setup-encryption>Setup Encryption</a></li><li><a href=#btrfs-layout>BTRFS Layout</a><ul><li></li></ul></li><li><a href=#system-setup>System setup</a></li><li><a href=#cleaning-up-archiso>Cleaning up <code>archiso</code></a></li><li><a href=#kernel-setup>Kernel setup</a></li><li><a href=#setup-notes>Setup notes</a><ul><li><a href=#nix>Nix</a></li><li><a href=#wayland-notes>Wayland notes</a></li><li><a href=#laptop-tweaks>Laptop Tweaks</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>5 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2023-05-01 15:22 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/laptop-setup-btrfs-notes/>Laptop setup notes btrfs subvolumes</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#input-variants-with-sway>Input variants with <code>sway</code></a></li><li><a href=#setup-encryption>Setup Encryption</a></li><li><a href=#btrfs-layout>BTRFS Layout</a><ul><li></li></ul></li><li><a href=#system-setup>System setup</a></li><li><a href=#cleaning-up-archiso>Cleaning up <code>archiso</code></a></li><li><a href=#kernel-setup>Kernel setup</a></li><li><a href=#setup-notes>Setup notes</a><ul><li><a href=#nix>Nix</a></li><li><a href=#wayland-notes>Wayland notes</a></li><li><a href=#laptop-tweaks>Laptop Tweaks</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></aside><hr><div class="post-content e-content"><div class="notice--info post-series-top"><p>This post is part of the <a href=https://rgoswami.me/series/archlinux-chronoscope/>ArchLinux Chronoscope</a> series.</p></div><blockquote><p>Thoughts on laptop configurations for ArchLinux in 2023, with <code>btrfs</code> and <code>sway</code></p></blockquote><div class="warning-alert alert"><div class=alert-heading><p><strong>Warning</strong></p></div><p>This post is a little less complete than most, it has been dated to roughly the correct time chronologically.</p></div><h2 id=background>Background</h2><p>I split this post from the <a href=/posts/customizing-archlinux-im/>previous one</a>, to make each more self contained.
Since the installation media has more features one might perhaps use <code>gparted</code>
for resizing disks, use the GUI for managing networks, etc. Personally I
generally allocate a chunk from whatever other OS is present in <code>gparted</code>, and
format it as unformatted. This is so I can use <a href=https://wiki.archlinux.org/title/Dm-crypt/Encrypting_an_entire_system>encrypted</a> BTRFS
<a href=https://wiki.archlinux.org/index.php/Btrfs#Subvolumes>subvolumes</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><h2 id=input-variants-with-sway>Input variants with <code>sway</code></h2><p>Instead of setting up a configuration, I typically use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>swaymsg input type:keyboard xkb_variant colemak
</span></span><span class=line><span class=ln>2</span><span class=cl>swaymsg input type:keyboard xkb_layout us
</span></span></code></pre></div><h2 id=setup-encryption>Setup Encryption</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>cryptsetup luksFormat /dev/nvme0n1p5
</span></span><span class=line><span class=ln>2</span><span class=cl>cryptsetup open /dev/nvme0n1p5 luks
</span></span><span class=line><span class=ln>3</span><span class=cl>mkfs.btrfs -L ROOT /dev/mapper/luks
</span></span></code></pre></div><h2 id=btrfs-layout>BTRFS Layout</h2><p>The logic behind the flat <code>btrfs</code> layout is to separate things which should
remain untouched during rollbacks of the system. I use a variant of a layout
from <a href=https://github.com/archlinux/archinstall/issues/781>this issue</a> (more on layouts <a href=https://github.com/lnussel/lnussel.github.io/blob/fs/_posts/2020-12-16-fslayout.md>here</a> and <a href=https://www.jwillikers.com/btrfs-layout>here</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>mount /dev/mapper/luks /mnt
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1># Root</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>btrfs sub create /mnt/@ <span class=c1># /</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># Needs additional setup</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>btrfs sub create /mnt/@swap
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># Manage each home separately</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>btrfs sub create /mnt/@home <span class=c1># /home</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>btrfs sub create /mnt/@pkg <span class=c1># /var/cache/pacman/pkg</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>btrfs sub create /mnt/@.snapshots
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># VMs shouldn&#39;t be rolled back</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>btrfs sub create /mnt/@VMs <span class=c1># /var/lib/libvirt/images</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>btrfs sub create /mnt/@containers <span class=c1># for docker</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># Log files should be consistent</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>btrfs sub create /mnt/@log <span class=c1># /var/log</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1># Often has licensed software</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>btrfs sub create /mnt/@opt <span class=c1># /opt</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>btrfs sub create /mnt/@usr_local <span class=c1># /usr/local</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>umount /mnt
</span></span></code></pre></div><p>These can then be mounted with reasonable defaults (<a href=https://www.jwillikers.com/btrfs-mount-options.html>detailed here</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@ /dev/mapper/luks /mnt
</span></span><span class=line><span class=ln> 2</span><span class=cl>mkdir -p /mnt/btrfs <span class=c1># To mount the btrfs root: https://unix.stackexchange.com/q/367123/246530</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvolid<span class=o>=</span><span class=m>5</span> /dev/mapper/luks /mnt/btrfs
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># Mount the other subvolumes</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>mkdir -p /mnt/<span class=o>{</span>boot,home,var/cache/pacman/pkg,.snapshots,var/lib/libvirt/images,var/log,opt,usr/local<span class=o>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@home /dev/mapper/luks /mnt/home
</span></span><span class=line><span class=ln> 7</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@pkg /dev/mapper/luks /mnt/var/cache/pacman/pkg
</span></span><span class=line><span class=ln> 8</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@VMs /dev/mapper/luks /mnt/var/lib/libvirt/images
</span></span><span class=line><span class=ln> 9</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@log /dev/mapper/luks /mnt/var/log
</span></span><span class=line><span class=ln>10</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@opt /dev/mapper/luks /mnt/opt
</span></span><span class=line><span class=ln>11</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@usr_local /dev/mapper/luks /mnt/usr/local
</span></span><span class=line><span class=ln>12</span><span class=cl>mount -o noatime,nodiratime,compress<span class=o>=</span>zstd,space_cache<span class=o>=</span>v2,ssd,subvol<span class=o>=</span>@.snapshots /dev/mapper/luks /mnt/.snapshots
</span></span></code></pre></div><p>We also need to mount the EFI partition:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>mount -o rw,relatime,fmask<span class=o>=</span>0022,dmask<span class=o>=</span>0022,iocharset<span class=o>=</span>ascii,shortname<span class=o>=</span>mixed /dev/nvme0n1p1 /mnt/boot
</span></span></code></pre></div><p>Switch to sddm with weston for a better display manager</p><h5 id=handling-swap>Handling <code>swap</code></h5><p>To get the physical offset, as <a href=https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate#Hibernation_into_swap_file_on_Btrfs>noted on the ArchWiki</a> we can use <code>btrfs inspect-internal</code><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> /mnt/btrfs/@swap
</span></span><span class=line><span class=ln>2</span><span class=cl>truncate -s <span class=m>0</span> ./swapfile
</span></span><span class=line><span class=ln>3</span><span class=cl>chattr +C ./swapfile
</span></span><span class=line><span class=ln>4</span><span class=cl>btrfs property <span class=nb>set</span> ./compression none
</span></span><span class=line><span class=ln>5</span><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>./swapfile <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>count</span><span class=o>=</span>&lt;FILE-SIZE-IN-MiB&gt; <span class=nv>status</span><span class=o>=</span>progress
</span></span><span class=line><span class=ln>6</span><span class=cl>chmod <span class=m>600</span> ./swapfile
</span></span><span class=line><span class=ln>7</span><span class=cl>mkswap ./swapfile
</span></span><span class=line><span class=ln>8</span><span class=cl>swapon ./swapfile
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=nb>cd</span> -
</span></span></code></pre></div><h2 id=system-setup>System setup</h2><p>I like the live USB packages, so I tend to use the <code>./offlineInst.sh</code> instead of <code>pacstrap</code>. Some additional configuration is needed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>arch-chroot /mnt
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1># Set the hostname</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nb>echo</span> &lt;HOSTNAME&gt; &gt; /etc/hostname
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># Locale is set already to C.UTF-8</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># Setup timezone</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>ln -sf /usr/share/zoneinfo/&lt;WHATEVER&gt; /etc/localtime
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1># Hosts should be updated</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># cat /etc/hosts</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># #&lt;ip&gt; &lt;hostname.domain.org&gt; &lt;hostname&gt;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># 127.0.0.1 &lt;HOSTNAME&gt;.localdomain &lt;HOSTNAME&gt;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># ::1 localhost.localdomain localhost</span>
</span></span></code></pre></div><p>Finally, a password needs to be setup for the <code>root</code> user with <code>passwd</code>. It is generally a good idea to make a new user too:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>useradd -m username -s /bin/zsh
</span></span><span class=line><span class=ln>2</span><span class=cl>passwd username
</span></span><span class=line><span class=ln>3</span><span class=cl>usermod -aG wheel username <span class=c1># for sudo</span>
</span></span></code></pre></div><p>Some other (optional) <code>colemak</code> steps:
,#+begin_src bash
echo KEYMAP=colemak > /etc/vconsole.conf
#+end_src</p><h2 id=cleaning-up-archiso>Cleaning up <code>archiso</code></h2><p>Some cruft is copied over if the <code>offlineInst.sh</code> script is used. We will need to:</p><ul><li>Remove the local repository from <code>/etc/pacman.conf</code></li><li>Remove the preset <code>archiso</code> for <code>mkinitcpio</code> (by deleting <code>/etc/mkinitcpio.d/linux.preset</code>)</li></ul><p>We also need to remove the user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>userdel hzlinarch
</span></span><span class=line><span class=ln>2</span><span class=cl>rm -rf /home/hzlinarch
</span></span></code></pre></div><p>Some other things to be deleted (should be updated in the script):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>sudo rm -rf /var/lib/pacman/local/mkinitcpio-archiso-*
</span></span><span class=line><span class=ln>2</span><span class=cl>sudo rm -rf /usr/lib/initcpio/hooks/archiso*
</span></span><span class=line><span class=ln>3</span><span class=cl>sudo rm -rf /usr/share/doc/mkinitcpio-archiso
</span></span></code></pre></div><h2 id=kernel-setup>Kernel setup</h2><p>The <code>initramfs</code> hooks need to be modified for <code>swap</code> and to recognize <code>btrfs</code>
(also to remove all the <code>archiso</code> hooks):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># /etc/mkinitcpio.conf</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=nv>HOOKS</span><span class=o>=(</span>base keyboard udev kms autodetect modconf block keymap encrypt btrfs filesystems resume<span class=o>)</span>
</span></span></code></pre></div><p>Additionally, the kernel will need to be recompiled (at the very least). Since I
was using the <code>nitrous</code> variant, this time I recompiled with <code>mperformance</code> in
the <code>PKGBUILD</code> and this meant modifying the <code>rtl88xxau</code> kernel driver a bit as
it passes <code>-mhard-float</code> and <code>clang</code> will fail with unused arguments.</p><h2 id=setup-notes>Setup notes</h2><p>With the skeletal system setup, I needed only to add my customizations. Namely:</p><ul><li>All <code>clang</code> source builds</li><li>SDDM display management</li></ul><h3 id=nix>Nix</h3><p>My dotfiles expect <code>nix</code> for a variety of additional reasons.
With <code>sddm</code> however, the default installation adds all <code>nixbld</code> users to the
login screen. To prevent this, it is best to set the <code>MaximumUid</code>, for
example in <code>/etc/sddm.conf.d/08_nix_uid.conf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cfg data-lang=cfg><span class=line><span class=ln>1</span><span class=cl><span class=k>[Users]</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=na>MaximumUid</span><span class=o>=</span><span class=s>30000</span>
</span></span></code></pre></div><h3 id=wayland-notes>Wayland notes</h3><ul><li><code>caja</code> isn&rsquo;t compatible with <code>wayland</code> out of the box (but my favorite <code>thunar</code> is)</li><li>Thanks to a <a href=https://bugs.launchpad.net/ubuntu/+source/file-roller/+bug/1923033>very old</a> archive-manager (file-roller) bug, there aren&rsquo;t any really good native options for compression<ul><li><code>peazip</code> works as a native file and archive manager though</li></ul></li><li><code>kdialog</code> turned out to be really useful for handling issues with Chromium browsers<ul><li>Wasn&rsquo;t able to print or attach files or anything otherwise</li></ul></li></ul><h3 id=laptop-tweaks>Laptop Tweaks</h3><p>Mostly garnered from the <a href=https://wiki.archlinux.org/title/Laptop>Archwiki Laptop page</a>. I generally setup <code>/etc/systemd/{logind,sleep}.conf</code> with defaults from my older <code>etckeeper</code> configuration.</p><ul><li>Fingerprints worked natively with <code>fprintd</code> and a polkit (I used <code>lxpolkit</code>)</li><li>For keyring management <code>gnome-keyring</code> is fine (with <code>wl-clipboard</code>)</li></ul><h2 id=conclusions>Conclusions</h2><p>At this point, my notes came to an abrupt end. Presumably this meant I was able
to cobble together the rest of the system using the pointers there.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Based on the setup described <a href=https://nerdstuff.org/posts/2020/2020-004_arch_linux_luks_btrfs_systemd-boot/>here</a>,&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>This is derived from <a href=https://nerdstuff.org/posts/2020/2020-004_arch_linux_luks_btrfs_systemd-boot/>this post</a>, which in turn references the ArchWiki for <a href=https://wiki.archlinux.org/title/Btrfs#Swap_file>BTRFS</a> and <a href=https://wiki.archlinux.org/title/Swap#Swap_file>swap</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><hr><div class=post-series-bottom><h2>Series info</h2><h3>ArchLinux Chronoscope series</h3><ol><li><a href=https://rgoswami.me/posts/revisiting-wayland-2021-archlinux/>Revisiting Wayland for ArchLinux</a></li><li><a href=https://rgoswami.me/posts/customizing-archlinux-im/>Customizing ArchLinux Installation Media</a></li><li><b>Laptop setup notes btrfs subvolumes</b> &lt;-- You are here!</li></ol></div></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=/tags/ramblings>ramblings</a></span><span class=tag><a href=/tags/setup>setup</a></span><span class=tag><a href=/tags/archlinux>archlinux</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>895 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2023-05-01 15:22 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&amp;url=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20interesting...&amp;body=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f&amp;title=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20interesting...&amp;summary=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20interesting...&amp;source=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f&amp;resubmit=true&amp;title=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22Laptop%20setup%20notes%20btrfs%20subvolumes%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2flaptop-setup-btrfs-notes%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://rgoswami.me/posts/dart-sass-hugo-themes/><span class=button__icon>←</span>
<span class=button__text>Dart Sass and Hugo Themes</span>
</a></span><span class="button next"><a href=https://rgoswami.me/posts/customizing-archlinux-im/><span class=button__text>Customizing ArchLinux Installation Media</span>
<span class=button__icon>→</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><script src=https://utteranc.es/client.js repo=haozeke/haozeke.github.io issue-term=pathname theme=photon-dark label="Utterance 💬" crossorigin=anonymous async></script></div></main><footer class=footer><p>&copy; 2023
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-109503488-16","auto"),ga("send","pageview")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script><script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script><script src=/js/codefold.min.f0790269b87613b3bcff64022840fe1991eee3ea384e874c78a24022c9936bd888a3c14a05a10955881eebb1558e4fcf37576dac120cd0bf4ebaf7aca27b35b1.js></script><script src=/js/copyClipboard.min.1c92539aea398296101add0e80508ad94cb59fb37f946f06ec9ca1c7558a961b8de0c5595a921aed70aa91eb94d24db35e5a01243bc625f8b1814b17928f478b.js></script></body></html>