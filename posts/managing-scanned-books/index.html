<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[Rohit Goswami]"><meta name=description content="Where I consider digitizing colored content.
Background It so happened that I recently acquired a rather unique book which (somewhat oddly) had no corresponding digital variant¬†1. I&amp;rsquo;ve discussed how I modify books and papers for consumption on my Kobo Aura HD in the past, but this comes before that. Much of this is essentially a plug for Scantailor Advanced¬†2.
Goals Starting with the initial output pdf files from a scanner&amp;rsquo;s &amp;ldquo;scan to me&amp;rdquo; function¬†3 the goal is to have all the bells and whistles of a well-done digital book:"><meta name=keywords content="personal,workflow,ramblings"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://rgoswami.me/posts/managing-scanned-books/><meta name=generator content="Wooframework"><title>Managing Scanned Books :: Rohit Goswami ‚Äî Reflections
</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.054e30538b054b321af6575a7659f551cec63e1cef6bbd674acccadf856d3aff.css><meta itemprop=name content="Managing Scanned Books"><meta itemprop=description content="Where I consider digitizing colored content.
Background It so happened that I recently acquired a rather unique book which (somewhat oddly) had no corresponding digital variant¬†1. I&rsquo;ve discussed how I modify books and papers for consumption on my Kobo Aura HD in the past, but this comes before that. Much of this is essentially a plug for Scantailor Advanced¬†2.
Goals Starting with the initial output pdf files from a scanner&rsquo;s &ldquo;scan to me&rdquo; function¬†3 the goal is to have all the bells and whistles of a well-done digital book:"><meta itemprop=datePublished content="2023-06-26T21:34:00+00:00"><meta itemprop=dateModified content="2023-06-26T21:34:00+00:00"><meta itemprop=wordCount content="1152"><meta itemprop=image content="https://rgoswami.me/images/RG.png"><meta itemprop=keywords content="workflow,ramblings,"><meta property="og:title" content="Managing Scanned Books"><meta property="og:description" content="Where I consider digitizing colored content.
Background It so happened that I recently acquired a rather unique book which (somewhat oddly) had no corresponding digital variant¬†1. I&rsquo;ve discussed how I modify books and papers for consumption on my Kobo Aura HD in the past, but this comes before that. Much of this is essentially a plug for Scantailor Advanced¬†2.
Goals Starting with the initial output pdf files from a scanner&rsquo;s &ldquo;scan to me&rdquo; function¬†3 the goal is to have all the bells and whistles of a well-done digital book:"><meta property="og:type" content="article"><meta property="og:url" content="https://rgoswami.me/posts/managing-scanned-books/"><meta property="og:image" content="https://rgoswami.me/images/RG.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-26T21:34:00+00:00"><meta property="article:modified_time" content="2023-06-26T21:34:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rgoswami.me/images/RG.png"><meta name=twitter:title content="Managing Scanned Books"><meta name=twitter:description content="Where I consider digitizing colored content.
Background It so happened that I recently acquired a rather unique book which (somewhat oddly) had no corresponding digital variant¬†1. I&rsquo;ve discussed how I modify books and papers for consumption on my Kobo Aura HD in the past, but this comes before that. Much of this is essentially a plug for Scantailor Advanced¬†2.
Goals Starting with the initial output pdf files from a scanner&rsquo;s &ldquo;scan to me&rdquo; function¬†3 the goal is to have all the bells and whistles of a well-done digital book:"><meta property="article:section" content="notes"><meta property="article:published_time" content="2023-06-26 21:34:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><div class=header__inner><div class=header__left><div class=logo><a href=/ style=text-decoration:none><img src=/images/home.png alt></a></div></div><div class=header__mid><button class=button><div class=button__text><a href=https://rgoswami.me//search>Search</a></div></button></div><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li><li><a href=/series>Series</a></li></ul><ul class=menu__inner><li><a href=/categories>Categories</a></li><li><a href=/snippets>Snippets</a></li><li><a href=/tags>Tags</a></li></ul></nav><button id=toggleMenu><div class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></div></button>
<button class=theme-toggle id=toggleTheme><svg class="theme-toggler" width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></button></div></div></header><script src=/js/mathjax-config.js></script><script id=MathJax-script async src=https://unpkg.com/mathjax@3/es5/tex-chtml.js></script><aside class=sidebar><div class=hideTOC><button id=tocTog>TOC</button><div class="sideTOC m-fadeOut"><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#goals>Goals</a></li><li><a href=#from-pdf-to-tiff>From <code>pdf</code> to <code>tiff</code></a></li><li><a href=#ocr-setup>OCR Setup</a></li><li><a href=#concatenation-and-compression>Concatenation and Compression</a></li><li><a href=#toc-generation>TOC Generation</a></li><li><a href=#linearization>Linearization</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></div></div></aside><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>6 minutes<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Written: 2023-06-26 21:34 +0000</p></p></div><article class=h-entry><h1 class="post-title p-name"><a class=u-url href=https://rgoswami.me/posts/managing-scanned-books/>Managing Scanned Books</a></h1><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pen-tool"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg><span class="author u-author p-author"><a href=/author/rohit-goswami>Rohit Goswami</a></span></div><hr><aside id=toc class=sidebar><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#background>Background</a></li><li><a href=#goals>Goals</a></li><li><a href=#from-pdf-to-tiff>From <code>pdf</code> to <code>tiff</code></a></li><li><a href=#ocr-setup>OCR Setup</a></li><li><a href=#concatenation-and-compression>Concatenation and Compression</a></li><li><a href=#toc-generation>TOC Generation</a></li><li><a href=#linearization>Linearization</a></li><li><a href=#conclusions>Conclusions</a></li></ul></nav></aside><hr><div class="post-content e-content"><blockquote><p>Where I consider digitizing colored content.</p></blockquote><h2 id=background>Background</h2><p>It so happened that I recently acquired a rather unique book which (somewhat
oddly) had no corresponding digital variant¬†<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. I&rsquo;ve discussed how I modify books
and papers <a href=/posts/my-life-in-eink/>for consumption on my Kobo Aura HD in the past</a>, but this comes before
that. Much of this is essentially a plug for <a href=https://github.com/4lex4/scantailor-advanced>Scantailor Advanced</a>¬†<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h2 id=goals>Goals</h2><p>Starting with the initial output <code>pdf</code> files from a scanner&rsquo;s &ldquo;scan to me&rdquo; function¬†<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> the goal is to have all the bells and whistles of a well-done digital book:</p><dl><dt>Fixing orientations</dt><dd>This is meant to deal with rotations mostly, skew is later</dd><dt>Splitting pages</dt><dd>Since most scanners with books take two pages at a time</dd><dt>Handling skew</dt><dd>Deskewing works to reorient pages for visibility</dd><dt>Reworking content selections</dt><dd>The automated selection worked will for this, and is especially useful if there are artifacts</dd><dt>Adding back margins</dt><dd>For padding post selection</dd><dt>Output determination</dt><dd>600 DPI is generally enough, and &ldquo;mixed&rdquo; mode works great for images, the one thing to add is that &ldquo;Higher search sensitivity&rdquo; for picture shapes is pretty useful</dd></dl><p>These six steps can be carried out with Scantailor Advanced, which has a very
intuitive GUI for the same but there are but two more things:</p><ul><li>Optical Character Recognition (OCR)</li><li>A proper Table of Contents</li></ul><p>We will also have to first get high resolution images out of the <code>pdf</code> files.
For starters our project might look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>‚ùØ ls
</span></span><span class=line><span class=ln>2</span><span class=cl>appendix.pdf	chap6.pdf		     images
</span></span><span class=line><span class=ln>3</span><span class=cl>chap2_chap3.pdf  chap7.pdf		     toc_chap1_intro.pdf
</span></span><span class=line><span class=ln>4</span><span class=cl>chap4.pdf	chap8.pdf
</span></span><span class=line><span class=ln>5</span><span class=cl>chap5.pdf
</span></span></code></pre></div><h2 id=from-pdf-to-tiff>From <code>pdf</code> to <code>tiff</code></h2><p>Without any bells and whistles, a simple bash script will suffice to extract
high resolution <code>.tiff</code> files from <code>.pdf</code> inputs. The only caveat is the need to
carefully format the page names so they can be joined together easily. This lead to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=c1># The first page number (output file name) for the current PDF</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nb>export</span> <span class=nv>INP_SCAN_NAME</span><span class=o>=</span>toc_chap1_intro
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nv>output_index</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>pdftoppm -tiff <span class=s2>&#34;</span><span class=si>${</span><span class=nv>INP_SCAN_NAME</span><span class=si>}</span><span class=s2>.pdf&#34;</span>  temp
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nv>i</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>for</span> file in temp*.tif<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=nv>i</span><span class=o>=</span><span class=k>$((</span>i+1<span class=k>))</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=nv>new_index</span><span class=o>=</span><span class=k>$(</span><span class=nb>printf</span> <span class=s2>&#34;%03d&#34;</span> <span class=k>$((</span>output_index <span class=o>+</span> i <span class=o>-</span> <span class=m>1</span><span class=k>)))</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=nv>new_file</span><span class=o>=</span><span class=s2>&#34;page_</span><span class=si>${</span><span class=nv>new_index</span><span class=si>}</span><span class=s2>.tiff&#34;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  mv <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span> <span class=s2>&#34;images/</span><span class=nv>$new_file</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>At this point we can plug the images directly into ScanTailor Advanced and work
through the GUI.</p><h2 id=ocr-setup>OCR Setup</h2><p>Working with the TIFF images which form the output at ScanTailor Advanced is a
good bet. System packages needed are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>trizen -S tesseract tesseract-data-eng <span class=se>\
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=se></span>    tesseract-data-isl <span class=se>\
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=se></span>    ghostscript unpaper pngquant <span class=se>\
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=se></span>    img2pdf jbig2enc pdftk
</span></span></code></pre></div><p>Subsequently I ended up with a throwaway <code>conda</code> environment for using <a href=https://github.com/ocrmypdf/OCRmyPDF>OCRmyPDF</a>
(like with all <code>python</code> tools).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>micromamba create -p <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/.ocrtmp pip ocrmypdf
</span></span><span class=line><span class=ln>2</span><span class=cl>micromamba activate <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/.ocrtmp
</span></span></code></pre></div><p>Since <code>ocrmypdf</code> works on single PDF files or alternatively single images, one
brute-force approach is simply:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=nb>cd</span> out <span class=c1># where scantailor puts things</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>mkdir temp
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=k>for</span> file in page*.tif<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=nv>base</span><span class=o>=</span><span class=k>$(</span>basename <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span> .tif<span class=k>)</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  ocrmypdf -l eng --output-type pdf <span class=s2>&#34;</span><span class=nv>$file</span><span class=s2>&#34;</span> <span class=s2>&#34;temp/</span><span class=si>${</span><span class=nv>base</span><span class=si>}</span><span class=s2>.pdf&#34;</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>Which leads to a series of <code>.pdf</code> files.</p><h2 id=concatenation-and-compression>Concatenation and Compression</h2><p><a href=https://www.ghostscript.com/>Ghostscript</a> is the best way to get a single reasonably <strong>compressed</strong> output from
these files<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=nb>export</span> <span class=nv>OUTPUT_PDF_DPI</span><span class=o>=</span><span class=m>500</span> <span class=c1># good enough for me</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1># Or 600 for the Scantailor default</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>gs -q -dNOPAUSE -dBATCH -sDEVICE<span class=o>=</span>pdfwrite <span class=se>\
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=se></span>    -dCompatibilityLevel<span class=o>=</span>1.7 -dPDFSETTINGS<span class=o>=</span>/ebook <span class=se>\
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=se></span>    -dEmbedAllFonts<span class=o>=</span><span class=nb>true</span> -dSubsetFonts<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=se></span>    -dColorImageDownsampleType<span class=o>=</span>/Bicubic <span class=se>\
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=se></span>    -dColorImageResolution<span class=o>=</span><span class=nv>$OUTPUT_PDF_DPI</span> <span class=se>\
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=se></span>    -dGrayImageDownsampleType<span class=o>=</span>/Bicubic <span class=se>\
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=se></span>    -dGrayImageResolution<span class=o>=</span><span class=nv>$OUTPUT_PDF_DPI</span> <span class=se>\
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=se></span>    -dMonoImageDownsampleType<span class=o>=</span>/Bicubic <span class=se>\
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=se></span>    -dMonoImageResolution<span class=o>=</span><span class=nv>$OUTPUT_PDF_DPI</span> <span class=se>\
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=se></span>    -sOutputFile<span class=o>=</span><span class=s2>&#34;output_</span><span class=si>${</span><span class=nv>OUTPUT_PDF_DPI</span><span class=si>}</span><span class=s2>.pdf&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=se></span>    temp/*.pdf
</span></span></code></pre></div><p>Where the compatibility level is to <a href=https://stackoverflow.com/questions/29417217/how-are-pdf-files-able-to-be-partially-displayed-while-downloading>allow for linearization</a>¬†<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> (needs <a href=http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf>PDF 1.7</a>).
Sometimes this leads to files which are still too large (Table ref:tbl:sizes).</p><p><a id=table--tbl:sizes></a></p><div class=table-caption><span class=table-number><a href=#table--tbl:sizes>Table 1</a>:</span>
For a color book</div><table><thead><tr><th>DPI</th><th>Size (in MB)</th></tr></thead><tbody><tr><td>300</td><td>139.2</td></tr><tr><td>600</td><td>303.5</td></tr></tbody></table><p>In such cases <code>pdfsizeopt</code> (from <a href=https://github.com/pts/pdfsizeopt>here</a>) can be setup in the environment with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>mkdir <span class=nv>$CONDA_PREFIX</span>/tmp/pdfsizeopt
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nb>cd</span> <span class=nv>$CONDA_PREFIX</span>/tmp/pdfsizeopt
</span></span><span class=line><span class=ln> 3</span><span class=cl>wget -O pdfsizeopt_libexec_linux.tar.gz https://github.com/pts/pdfsizeopt/releases/download/2023-04-18/pdfsizeopt_libexec_linux-v9.tar.gz
</span></span><span class=line><span class=ln> 4</span><span class=cl>tar xzvf pdfsizeopt_libexec_linux.tar.gz
</span></span><span class=line><span class=ln> 5</span><span class=cl>rm -f    pdfsizeopt_libexec_linux.tar.gz
</span></span><span class=line><span class=ln> 6</span><span class=cl>wget -O pdfsizeopt.single https://raw.githubusercontent.com/pts/pdfsizeopt/master/pdfsizeopt.single
</span></span><span class=line><span class=ln> 7</span><span class=cl>chmod +x pdfsizeopt.single
</span></span><span class=line><span class=ln> 8</span><span class=cl>mv * <span class=nv>$CONDA_PREFIX</span>/bin <span class=o>&amp;&amp;</span> <span class=nb>cd</span> <span class=nv>$CONDA_PREFIX</span>/bin
</span></span><span class=line><span class=ln> 9</span><span class=cl>ln -s pdfsizeopt.single <span class=nv>$CONDA_PREFIX</span>/bin/pdfsizeopt
</span></span><span class=line><span class=ln>10</span><span class=cl>rm -rf <span class=nv>$CONDA_PREFIX</span>/tmp/*
</span></span></code></pre></div><p>Which can then be used as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>pdfsizeopt output_600.pdf
</span></span></code></pre></div><p>The compression takes a while¬†<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, but the results are completely
lossless and the reduction was pretty neat, from <code>390 MB</code> to <code>250 MB</code>, though it
took forever, and <a href=https://acrobat.adobe.com/link/acrobat/compress-pdf>Adobe Acrobat</a> reduced a <code>390 MB</code> file to <code>108 MB</code> in minutes.</p><figure><img src=/ox-hugo/2023-06-26_21-31-14_screenshot.png alt="Figure 1: Lossless compression (250 MB) on the left, lossy Acrobat compression (108 MB) on the right"><figcaption><p><span class=figure-number>Figure 1: </span>Lossless compression (<code>250 MB</code>) on the left, lossy Acrobat compression (<code>108 MB</code>) on the right</p></figcaption></figure><p>For handling the cover image I ended up with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl><span class=c1># from the ScanTailor 600 DPI image</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=c1># 39.3 MB</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>tiffcp -c zip:p9  cpage-1.tif cpage.tif <span class=c1>#  19.7 MB</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>convert cpage.tif -compress JPEG -quality 90% cpage.jpg <span class=c1># 2.0 MB</span>
</span></span></code></pre></div><p>Then I dumped it through a <a href=https://compressjpg.com/>web tool</a>¬†<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>(around <code>560 KB</code>) before finishing up
with <code>ocrmypdf</code> for the final <code>pdf</code> of <code>535 KB</code>.</p><h2 id=toc-generation>TOC Generation</h2><p>Sometimes I feel too lazy and end up doing my table of contents editing in
Master PDF editor¬†<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>. That being said my most favored way for
a fully fledged TOC with chapters and sub-headings is with the venerable <a href=https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/>PDFtk</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>cat toc.txt
</span></span><span class=line><span class=ln> 2</span><span class=cl>BookmarkBegin
</span></span><span class=line><span class=ln> 3</span><span class=cl>BookmarkTitle: Chapter <span class=m>1</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>BookmarkLevel: <span class=m>1</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>BookmarkPageNumber: <span class=m>5</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl>BookmarkBegin
</span></span><span class=line><span class=ln> 8</span><span class=cl>BookmarkTitle: Section 1.1
</span></span><span class=line><span class=ln> 9</span><span class=cl>BookmarkLevel: <span class=m>2</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>BookmarkPageNumber: <span class=m>6</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>BookmarkBegin
</span></span><span class=line><span class=ln>13</span><span class=cl>BookmarkTitle: Section 1.2
</span></span><span class=line><span class=ln>14</span><span class=cl>BookmarkLevel: <span class=m>2</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>BookmarkPageNumber: <span class=m>10</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>BookmarkBegin
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>BookmarkTitle: Chapter <span class=m>2</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>BookmarkLevel: <span class=m>1</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>BookmarkPageNumber: <span class=m>15</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>...
</span></span></code></pre></div><p>This can be applied with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>pdftk input.pdf update_info toc.txt output output_with_toc.pdf
</span></span></code></pre></div><p>Sometimes I end up padding the <code>pdf</code> with a few extra pages to ensure the page
numbers (printed) match the ones in the TOC.</p><h2 id=linearization>Linearization</h2><p>Since we targeted PDF 1.7, with linearization support¬†<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>. We need <a href=https://qpdf.readthedocs.io/>qpdf</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>micromamba install qpdf
</span></span><span class=line><span class=ln>2</span><span class=cl>qpdf --linearize output_300.pdf olin300.pdf
</span></span></code></pre></div><p>This has seemingly no effect on size so it can be the last step.</p><h2 id=conclusions>Conclusions</h2><p>This isn&rsquo;t my first time working with a scanned book. Felt like a lot more steps
than before though. Some more bash magic could have automated extracting the
images from scanner generated <code>pdf</code> files, and perhaps some other minor
tweaks¬†<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup> or other tools¬†<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>, though for my purposes, this
worked well enough. I was a little disappointed to not be able to hit optimal
file sizes without web tools, but given the amount of time expended, it was
probably to be expected.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>A few papercuts steeled my resolved to get this onto my devices&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>A more maintained fork of the old and venerable Scantailor which now weirdly has <a href=https://scantailor.org/>a fan-page</a> with dubious plugs to something called Truthfinder&mldr;&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Scanning the book in one go led to overly large attachments for my email provider. 576.96 766.08&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>If compression doesn&rsquo;t matter using <code>pdftk</code> (needed for the TOC) would be fine too.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>Swankier <a href=https://apryse.com/blog/pdf-format/what-is-pdf-linearization>explanation her</a>e&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>The TOC work can go on simultaneously, and compression can take days&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>When file-sizes are really a bottle neck there&rsquo;s also the sister <a href=https://pdfcompressor.com/>pdfcompressor</a> site, or for really small files there&rsquo;s the <a href=https://acrobat.adobe.com/link/acrobat/compress-pdf>Adobe Acrobat compressor</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>They used to have a really nice trial of version 4 which did everything I needed..&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>Some of my devices use web browsers for rendering <code>pdf</code> files.&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>ScanTailor could be run on an HPC most probably, as could the <code>ocrmypdf</code> step, the pdf compression definitely should (took around three days on my ThinkPad X1 Carbon 6th Gen)&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://github.com/Krasjet/pdf.tocgen>pdf.tocgen</a> is pretty cool&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=/tags/workflow>workflow</a></span><span class=tag><a href=/tags/ramblings>ramblings</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1152 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Posted: <time class=dt-published>2023-06-26 21:34 +0000</time></p><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f" target=_blank rel=noopener aria-label=Facebook><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15.84 9.5H13.5V8.48c0-.53.35-.65.6-.65h1.4v-2.3h-2.35c-2.3.0-2.65 1.7-2.65 2.8V9.5h-2v2h2v7h3v-7h2.1l.24-2z"/></svg></div>Facebook</div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?text=%22Managing%20Scanned%20Books%22%20seems%20like%20an%20interesting%20read%20from%20%40rg0swami&amp;url=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f" target=_blank rel=noopener aria-label=Twitter><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.5 7.4l-2 .2c-.4-.5-1-.8-2-.8C13.3 6.8 12 8 12 9.4v.6c-2 0-4-1-5.4-2.7-.2.4-.3.8-.3 1.3.0 1 .4 1.7 1.2 2.2-.5.0-1 0-1.2-.3.0 1.3 1 2.3 2 2.6-.3.4-.7.4-1 0 .2 1.4 1.2 2 2.3 2-1 1-2.5 1.4-4 1 1.3 1 2.7 1.4 4.2 1.4 4.8.0 7.5-4 7.5-7.5v-.4c.5-.4.8-1.5 1.2-2z"/><circle cx="12" cy="12" r="11.5"/></svg></div>Twitter</div></a><a class=resp-sharing-button__link href="mailto:?subject=%22Managing%20Scanned%20Books%22%20seems%20interesting...&amp;body=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f" target=_self rel=noopener aria-label=E-Mail><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.5 16c0 .8-.7 1.5-1.5 1.5H6c-.8.0-1.5-.7-1.5-1.5V8c0-.8.7-1.5 1.5-1.5h12c.8.0 1.5.7 1.5 1.5v8zm-2-7.5L12 13 6.5 8.5m11 6-4-2.5m-7 2.5 4-2.5"/><circle cx="12" cy="12" r="11.5"/></svg></div>E-Mail</div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f&amp;title=%22Managing%20Scanned%20Books%22%20seems%20interesting...&amp;summary=%22Managing%20Scanned%20Books%22%20seems%20interesting...&amp;source=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f" target=_blank rel=noopener aria-label=LinkedIn><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><path d="M15 12.5c-.28.0-.5.22-.5.5v3.5h-3s.03-6.48.0-7h3v.83s.46-.75 1.7-.75c1.56.0 2.3 1.12 2.3 3.3v3.62h-3V13c0-.28-.23-.5-.5-.5zm-7.5-3h2v7h-2z"/><circle cx="8.5" cy="6.5" r="1"/></svg></div>LinkedIn</div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f&amp;resubmit=true&amp;title=%22Managing%20Scanned%20Books%22%20seems%20interesting..." target=_blank rel=noopener aria-label=Reddit><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="11.5"/><ellipse cx="12" cy="14.37" rx="6.2" ry="4.24"/><path d="M14.3 16.25c-.62.36-1.42.57-2.3.57s-1.7-.2-2.32-.58"/><circle cx="14.61" cy="13.39" r=".98"/><circle cx="9.39" cy="13.39" r=".98"/><path d="M16.4 11.38c.26-.55.82-.92 1.47-.92.9.0 1.63.73 1.63 1.63.0.8-.6 1.47-1.38 1.6"/><circle cx="17.22" cy="7.52" r="1.63"/><path d="M7.6 11.38c-.26-.54-.82-.92-1.47-.92-.9.0-1.63.73-1.63 1.63.0.8.6 1.47 1.38 1.6M12 10.12s-.08-4.82 3.6-2.6"/></svg></div>Reddit</div></a><a class=resp-sharing-button__link href="whatsapp://send?text=%22Managing%20Scanned%20Books%22%20seems%20interesting...%20https%3a%2f%2frgoswami.me%2fposts%2fmanaging-scanned-books%2f" target=_blank rel=noopener aria-label=WhatsApp><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--medium"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle xmlns="http://www.w3.org/2000/svg" cx="12" cy="12" r="11.5"/><path stroke-width="1" d="M17.6 6.2c-1.5-1.5-3.4-2.3-5.5-2.3-4.3.0-7.8 3.5-7.8 7.8.0 1.4.4 2.7 1 3.9l-1.1 4 4.1-1.1c1.1.6 2.4.9 3.7.9 4.3.0 7.8-3.5 7.8-7.8.1-2-.7-3.9-2.2-5.4zm-5.5 11.9c-1.2.0-2.3-.3-3.3-.9l-.2-.1-2.4.6.7-2.4-.2-.2c-.6-1-1-2.2-1-3.4.0-3.6 2.9-6.5 6.5-6.5 1.7.0 3.3.7 4.6 1.9 1.2 1.2 1.9 2.8 1.9 4.6-.1 3.5-3 6.4-6.6 6.4zm3.5-4.8c-.2-.1-1.1-.6-1.3-.6-.2-.1-.3-.1-.4.1s-.5.6-.6.8c-.1.1-.2.1-.4.0s-.8-.3-1.6-1c-.6-.5-1-1.2-1.1-1.3-.1-.2.0-.3.1-.4l.3-.3s.1-.2.2-.3c.1-.1.0-.2.0-.3s-.4-1.1-.6-1.4c-.2-.4-.3-.3-.4-.3h-.4s-.3.0-.5.2-.7.7-.7 1.6c0 1 .7 1.9.8 2s1.4 2.1 3.3 2.9c.5.2.8.3 1.1.4.5.1.9.1 1.2.1.4-.1 1.1-.5 1.3-.9.2-.5.2-.8.1-.9.0-.2-.2-.3-.4-.4z"/></svg></div>WhatsApp</div></a></div><p><a href=https://notbyai.fyi/><img id=notbyai src=https://rgoswami.me//images/Written-By-Human-Not-By-AI-Badge-white.svg alt="Written by human, not by AI" style=width:initial;border-radius:0></a></p><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://rgoswami.me/posts/cpp-library-blueprints-pybind/><span class=button__icon>‚Üê</span>
<span class=button__text>CPP Library Blueprints for Python Bindings</span>
</a></span><span class="button next"><a href=https://rgoswami.me/posts/dart-sass-hugo-themes/><span class=button__text>Dart Sass and Hugo Themes</span>
<span class=button__icon>‚Üí</span></a></span></div></div><div id=comments class=thin><div class=pagination__title><span class=pagination__title-h>Comments</span><hr></div><script src=https://utteranc.es/client.js repo=haozeke/haozeke.github.io issue-term=pathname theme=photon-dark label="Utterance üí¨" crossorigin=anonymous async></script></div></main><footer class=footer><p>&copy; 2024
<span><a href=https://rgoswami.me/>Rohit Goswami (HaoZeke)</a></span>
<a href=/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><br><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.
Powered by <a href=http://gohugo.io><u>Hugo</u></a> and <a href=https://github.com/HaoZeke/hugo-theme-hello-friend-ng-hz><u>this theme</u></a>.</br>Hosted with <u><a href=https://www.netlify.com/>Netlify</a></u>.</br><script src=https://liberapay.com/rohit/widgets/button.js></script><noscript><a href=https://liberapay.com/rohit/donate><img alt="Donate using Liberapay" src=https://liberapay.com/assets/widgets/donate.svg></a></noscript></p></footer></div><script src=/bundle.min.5fae9992ea406007408dc33b0b3a8376d61e2f1d6ac50ba1dad7580ac50afb5199bcef3bbc3677e77553a9980bf882cf71edc2f755687dd7725f12ece4304ac2.js></script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-109503488-16","auto"),ga("send","pageview")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","3z2xvwqu4u")</script><script data-goatcounter=https://rgoswami.goatcounter.com/count async src=//gc.zgo.at/count.js></script><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push("101265002")</script><script async src=https://static.getclicky.com/js></script><script src=https://cdn.jsdelivr.net/npm/readmore-js@3.0.0-beta-1/dist/readmore.min.js></script><script src=/js/codefold.min.f0790269b87613b3bcff64022840fe1991eee3ea384e874c78a24022c9936bd888a3c14a05a10955881eebb1558e4fcf37576dac120cd0bf4ebaf7aca27b35b1.js></script><script src=/js/copyClipboard.min.1c92539aea398296101add0e80508ad94cb59fb37f946f06ec9ca1c7558a961b8de0c5595a921aed70aa91eb94d24db35e5a01243bc625f8b1814b17928f478b.js></script></body></html>